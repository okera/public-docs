<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Okera Platform Architecture Overview | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="theme/js/customscripts.js"></script>

<script>
$( document ).ready(function() {
  $( "blockquote:contains('Note')" ).addClass( "admonitionblock note" );
  $( "blockquote:contains('Warning')" ).addClass( "admonitionblock warning" );
  $( "blockquote:contains('Tip')" ).addClass( "admonitionblock tip" );
  $( ".admonitionblock.note" ).prepend( '<i class="fa fa-check admonition"></i>' );
  $( ".admonitionblock.warning" ).prepend( '<i class="fa fa-exclamation-triangle admonition"></i>' );
  $( ".admonitionblock.tip" ).prepend( '<i class="fa fa-lightbulb-o admonition"></i>' );
});
</script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="navbar-wordmark"><a href="/">
              <img src="assets/images/okera-wordmark-white.png" alt="Okera wordmark" /></a>
            </div>

        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="search">Search</a></li>
                
                
                
                <li><a href="https://www.okera.com/blog" target="_blank">Okera Blog</a></li>
                
                
                
                <li><a href="https://okera.com" target="_blank">okera.com</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <!-- comment out this block if you want to hide search
                <li class="dropdown">

                  <div id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>

                </li>
                end search -->
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="okera-architecture-overview">Platform Architecture Overview</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing the Deployment Manager</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Guide</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization">Authorization Guide</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="catalog-rest-api">REST API</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Client Configuration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="third-party-integration">Third-Party Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="faq">Frequently Asked Questions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="okera-platform-architecture-overview">Okera Platform Architecture Overview</h1>

<p>The <a href="catalog-overview">Catalog Overview</a> and <a href="odas-overview">ODAS Overview</a> documents introduce the two major components of the <em>Okera Active Data Access Platform</em> (ADAP, or Okera Platform for short).
This document takes the next step, explaining the Platform’s architecture and showing the components in action for various client requests.</p>

<h2 id="architecture">Architecture</h2>

<p>On a more technical level, the Okera Platform is divided into services that are accessible for clients, and a few other services that are only accessible internally by administrators or other services.
This is intentionally the case to reduce complexity and concentrate access for clients to just a few locations.
The following diagram shows all of the platform services in context.</p>

<p><a name="architecture-overview-diagram"></a>
<img src="assets/images/architecture-overview.png" style="width: 100%; max-width:100%;" /></p>

<p>First we will introduce how clients access the Okera Platform, and then break up the services shown in the diagram based on their scope.</p>

<h3 id="client-access">Client Access</h3>

<p>The diagram starts in the top right corner with clients of varying kind communicating with the platform.
There are three major access points:</p>

<ol>
  <li>
    <p><strong>The Okera Portal Web UI</strong></p>

    <p>Clients can use Okera Portal to interact with the underlying platform.
The web UI provides access to the catalog services, such as the Schema Registry and the Policy Engine, and enables self-service dataset discovery.
It also offers a workspace to issue SQL statements against the platform.
Behind the scenes, this web application uses the REST API gateway service to interact with your platform’s services, just the way your bespoke or customized applications can.</p>
  </li>
  <li>
    <p><strong>The REST gateway service</strong></p>

    <p>Many clients have support for the ubiquitous REST protocol, avoiding most of the issues that arise when dealing with custom protocols.
The REST gateway service gives access to the all necessary client API calls.
This includes both the <strong>Schema Registry</strong> for creating, altering, or dropping various objects, as well as the <strong>Policy Engine</strong> for granting or revoking access related to all registered objects.
See the <a href="catalog-rest-api">Catalog API</a> documentation for the list of supported REST calls.</p>
  </li>
  <li>
    <p><strong>The provided client libraries</strong></p>

    <p>Finally, Okera provides a set of libraries for interfacing directly with the Catalog and ODAS services, including Planners and the Workers.
This is the recommended way to integrate with the Catalog and ODAS services.</p>
  </li>
</ol>

<p>The <a href="#architecture-overview-diagram">Platform architecture diagram</a> has a dashed line that separates the <em>external services</em>, which provide the client connectivity, from the <em>internal support and management services</em>.
The following discusses the external and internal components separately, and how they work together to provide the services to all clients alike.</p>

<h3 id="client-accessible-components">Client Accessible Components</h3>

<p>The <em>external</em> components in the architecture provide the major functionality of the platform, which is the data access and metadata management, as needed by clients such as interactive users to automated applications.</p>

<p>Note how the above referred to <em>services</em>, such as the REST API, Planner, and Catalog services.
For failover purposes and continuous availability of these services, it is common in practice to have each service running multiple times.
This is explained in greater detail in the <a href="cluster-administration#scaling-an-existing-cluster">Cluster Administration</a> documentation.
In short, you can use the provided administrative functionality to instruct the platform to add redundant instances of the services (expressed as multiple, stacked boxes in the diagram) so that in case of a node failure the system will continue to operate.</p>

<p>The Planner service is also responsible for exposing the Catalog services: the Schema Registry and Policy Engine.
In effect, the clients use the REST API or client libraries as proxies (as shown in the diagram) to these two Catalog services, provided by the Planner instances.
The clients also communicate with the Planner as part of a query execution (see <a href="#communication">Communication</a> below).
For a general overview of all available services and how they can be combined, please refer to the <a href="cluster-types">Cluster Types</a> documentation.</p>

<p>The ODAS client libraries are used by many of the provided higher-level client integrations, including Hive, Presto, Spark, and others.
This integration support is needed to hide Okera as much as possible behind common tools, with which users are already familiar.
For example, enabling the Hive integration allows for existing Hive setups to switch from direct usage of underlying data sources to use ODAS instead.
There is no need to alter any metadata at all.</p>

<p>For Python, there are two different ways of communicating with an ODAS cluster: which is using the (legacy) REST API or the (newer) native <strong>PyOkera library</strong>.</p>

<p><strong>Tip:</strong> Wherever possible, use PyOkera, as it performs markedly better than REST.</p>

<h3 id="internal-and-management-components">Internal and Management Components</h3>

<p>Note that these are intentionally referred to as <em>internal</em> services, as Okera may change these over time, as needed.
Their purpose is to support the external services and enable administrators to manage the ODAS clusters.</p>

<p>For the latter, there is the option to maintain ODAS clusters using the <strong>Deployment Manager</strong> (DM), which is installed as the first component in the Okera Platform setup.
See the <a href="cluster-administration">Cluster Administration</a> document for more details on how to manage ODAS clusters with the DM.</p>

<p>The DM uses Kubernetes (K8s) to manage the cluster services, including the redundant instance for fail-safety.
Each service is packaged into its own image and started as a separate container in Kubernetes pods.</p>

<p>The DM does the following when creating new ODAS clusters (simplified):</p>

<ol>
  <li>
    <p>Launch script execution</p>

    <p>This step provisions the compute resources; for example, the AWS EC2 instances as configured by the administrator.
It also sets instance-specific <em>user data</em> (an EC2 concept) to trigger the next step as part of the instance creation.</p>
  </li>
  <li>
    <p>ODAS Agent installation</p>

    <p>The custom user data provided by the DM contains a shell script that installs the necessary base packages and binaries from a shared staging location (for example, S3, avoiding the need to connect to the Internet), including the DMs own Agent service.
This happens on each of the provisioned instances, while the DM is waiting for all Agents to report for duty.</p>
  </li>
</ol>

<p>After the Agents have started on each node, these next steps happen (again, simplified):</p>

<ol>
  <li>
    <p>ODAS package installation</p>

    <p>Each Agent installs all required ODAS packages on its host.</p>
  </li>
  <li>
    <p>Kubernetes Master startup</p>

    <p>This starts the Kubernetes control plane services on the first provisioned EC2 instance.</p>
  </li>
  <li>
    <p>Kubernetes Workers startup</p>

    <p>The ODAS Agents on all other EC2 instances wait for the K8s master to be available, and then start all necessary K8s worker machine components.</p>
  </li>
  <li>
    <p>Containers startup</p>

    <p>Finally, the Kubernetes takes over and starts the managed ODAS services by deploying the ODAS images as containers into pods.</p>
  </li>
</ol>

<p>Using the DM command-line tool or API allows an administrator to modify an ODAS cluster setup, which in turn may instruct Kubernetes to run more or fewer containers.</p>

<h2 id="communication">Communication</h2>

<p>Once the cluster is operational, a client can communicate with the cluster services.
Refer to the <a href="odas-authentication">Authentication</a> documentation for more details on how to secure the interactions between clients and an ODAS cluster.</p>

<h3 id="read-request">Read Request</h3>

<p>The following sequence diagram shows how Presto, as an example interacts with ODAS after Okera integration is enabled (see <a href="client-integration#hadoop-ecosystem-tools-spark-mapreduce-hive-presto">Hadoop ecosystem tools integration</a>).</p>

<p><img src="assets/images/architecture-dml-sequence-1.png" alt="Read Request Sequence Diagram" title="Sequence diagram for a read request" /></p>

<p>Depicted is a read request issued by Zeppelin (an interactive notebook service), showing the various calls made between the client and the services.
Once a query is submitted in Zeppelin, it will use the Presto JDBC driver to plan and execute the request.
The ODAS Planner is used to retrieve the dataset schema and instruct Presto how to distribute the query across its workers.
Each worker is handed a list of tasks to perform, which is querying a subset of the resulting records.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                  <img src="assets/images/icon-footer.png" class="logo" />
                  <div class="footer-meta">
               &copy;2018 Okera, Inc. All rights reserved. <br />
 Site last generated: Aug 15, 2018
                  </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
