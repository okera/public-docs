<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Advanced Installation Procedures | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<!-- Algolia Docusearch -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<script>
$( document ).ready(function() {
  $( "blockquote:contains('Note')" ).addClass( "admonitionblock note" );
  $( "blockquote:contains('Warning')" ).addClass( "admonitionblock warning" );
  $( "blockquote:contains('Tip')" ).addClass( "admonitionblock tip" );
  $( ".admonitionblock.note" ).prepend( '<i class="fa fa-check admonition"></i>' );
  $( ".admonitionblock.warning" ).prepend( '<i class="fa fa-exclamation-triangle admonition"></i>' );
  $( ".admonitionblock.tip" ).prepend( '<i class="fa fa-lightbulb-o admonition"></i>' );
});
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->




    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-8">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="navbar-form" id="search-nav-container" role="search">
                <div class="form-group">
                    <input id="search-okera" type="text" class="form-control" placeholder="Search the docs...">
                </div>
            </form>
        </div>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
        <!-- New Search Input  -->
        <!-- <div class="navbar-form" id="search-demo-container">
                    <input id="search-okera" type="text" placeholder="Search the docs...">
                </div> -->
        <!-- END SEARCH -->
        <!-- /.container -->
    </div>
</nav>

<!-- Algolia Docusearch Script -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '0d3d7114a46452ccf7fa6e718e2f5429',
        indexName: 'okera',
        inputSelector: '#search-okera',
        debug: false // Set debug to true if you want to inspect the dropdown
    });
</script>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing the Deployment Manager</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installing the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="okera-prereq">Okera Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="okera-installation-setting-up-deployment-manager">Setting Up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="okera-installation-setting-up-odas-cluster">Setting Up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="advanced-install">Advanced Installation Options</a></li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="catalog-rest-api">REST API</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Client Configuration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="third-party-integration">Third-Party Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="faq">Frequently Asked Questions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="advanced-installation-procedures">Advanced Installation Procedures</h1>

<p>This document describes advanced Okera installs.
This document assumes the user is familiar with the <a href="install">base installation</a> and will describe changes relative to that process.</p>

<p>This document covers the following categories of additional installation options:</p>

<ul>
  <li><a href="#deployment-manager-configuration">Deployment Manager Configuration</a></li>
  <li><a href="#special-hive-metastore-management">Special Hive Metastore Management</a></li>
  <li><a href="#advanced-networking">Advanced Networking</a></li>
</ul>

<h2 id="deployment-manager-configuration">Deployment Manager Configuration</h2>

<p>Basic DM setup is instructed in the main <a href="install#dm-configuration-options">Installation Guide</a>.
This section describes some additional options.</p>

<h3 id="changing-dm-configuration-values">Changing DM Configuration Values</h3>

<p>The environment variables set in the <code class="highlighter-rouge">env.sh</code> script are stored by the deployment manager when it starts up.
When a deployment manager creates an Okera cluster, the current values of those environment variables are applied to the new cluster.</p>

<p>To change the values used by a deployment manager, you must either update the <code class="highlighter-rouge">env.sh</code> script (assuming that it’s in the default location of <code class="highlighter-rouge">/etc/okera/</code>), or update your environment variables.
Then, restart the deployment manager by running:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/opt/okera/deployment-manager/bin/deployment-manager
</code></pre></div></div>

<p>Clusters created after the deployment manager is restarted use the new configuration values.</p>

<h3 id="changing-configuration-values-in-a-running-cluster">Changing Configuration Values in a Running Cluster</h3>

<blockquote>
  <p><strong>Note</strong> Certain infrastructure-specific configurations are immutable after cluster creation.
These configurations cannot be updated without creating a completely new cluster.
If you are not seeing a configuration value updated after following these steps, it could be an immutable configuration.</p>
</blockquote>

<p>To change configuration values on a running cluster, do the following:</p>

<ol>
  <li>Update the desired configuration values on the deployment manager (described above)</li>
  <li>Restart the deployment manager (described above)</li>
  <li>Restart the cluster, <code class="highlighter-rouge">ocadm cluster &lt;id&gt; restart</code></li>
  <li>Wait for the restart to complete, approximately 5 minutes.</li>
</ol>

<h3 id="working-with-okera_install_dir">Working with OKERA_INSTALL_DIR</h3>

<p>The value of <code class="highlighter-rouge">OKERA_INSTALL_DIR</code> has no effect on where Deployment Manager loads the <code class="highlighter-rouge">/etc/okera/env.sh</code> file.
The Deployment Manager always attempts to read config values from <code class="highlighter-rouge">/etc/okera/env.sh</code>, if it exists.
If <code class="highlighter-rouge">env.sh</code> does not exist in <code class="highlighter-rouge">/etc/okera</code>, the Deployment Manager falls back to the config values from environment variables.
The setting <code class="highlighter-rouge">OKERA_INSTALL_DIR</code>, defined either in environment variables or in <code class="highlighter-rouge">/etc/okera/env.sh</code>, is used after the Deployment Manager is successfully configured and running; it is for writing additional files.</p>

<h3 id="okera_server_hostport">OKERA_SERVER_HOSTPORT</h3>

<p>This is the host:port for running the Deployment Manager.
The host listens to all interfaces (by default) and runs on port 8085 (e.g. 0.0.0.0:8085).
This port does not need to be made accessible to the typical user who accesses data, but it is required by the one who administers Okera clusters.</p>

<p><strong>Example:</strong> Setting the DM’s host and port</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OKERA_SERVER_HOSTPORT</span><span class="o">=</span>10.10.1.123:8085
</code></pre></div></div>

<h3 id="okera_dm_db_name">OKERA_DM_DB_NAME</h3>

<p>This is the name of the relational database at the <code class="highlighter-rouge">OKERA_DB_URL</code> location (the RDBMS instance) that the Deployment Manager uses.
If this RDBMS instance is only backing a single Deployment Manager install, the <code class="highlighter-rouge">OKERA_DM_DB_NAME</code> does not need to be set.
Otherwise, each installation can have a different database.
The database does not need to exist before starting the DM as long as its host instance is available.</p>

<p><strong>Example:</strong> Setting the relational database name</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OKERA_DM_DB_NAME</span><span class="o">=</span>okera_db
</code></pre></div></div>

<p>The <code class="highlighter-rouge">OKERA_DM_DB_NAME</code> value has format restrictions.
It must begin with an alphabetic character and subsequent characters are restricted to alphanumerics and the underscore character (‘_’).</p>

<p>This command will evaluate the validity of the database name once the environment variable is established.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[[</span> <span class="s2">"</span><span class="nv">$OKERA_DM_DB_NAME</span><span class="s2">"</span> <span class="o">=</span>~ ^[A-Za-z][A-Za-z0-9_]<span class="k">*</span><span class="nv">$ </span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Is valid."</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"Is not valid."</span>
</code></pre></div></div>

<h2 id="special-hive-metastore-management">Special Hive Metastore Management</h2>

<p>In a typical Okera Data Access Service install, ODAS will start up and manage a service compatible with Hive Metastore (HMS).
You are not restricted to this default arrangement.</p>

<h3 id="external-hive-metastore">External Hive Metastore</h3>

<p>If you prefer to have ODAS use an existing, externally managed HMS instance, you can do so.
In this configuration, ODAS will simply read and write from the external HMS, but all other behavior is unchanged.</p>

<p>ODAS is supports Hive 1.1.0 and up.</p>

<p>To use an external HMS, add this config to your Deployment Manager configs,
typically <code class="highlighter-rouge">/etc/okera/env.sh</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OKERA_EXTERNAL_HMS_CONFIG</span><span class="o">=</span>&lt;path to hive-site.xml&gt;
</code></pre></div></div>

<p>The value should be a full path to the <code class="highlighter-rouge">hive-site.xml</code> client config for the external HMS.
The path must be accessible from the Deployment Manager process but can be either local or remote (for example, S3).
After setting the config and restarting the Deployment Manager, newly created clusters will use the external HMS.
When restarted, existing clusters will update to use the external HMS config.</p>

<p>It is possible to have multiple ODAS clusters use the same external HMS, subject to the concurrency settings of your HMS.</p>

<h3 id="sharing-existing-hive-metastore-or-sentry-rdbms">Sharing Existing Hive Metastore or Sentry RDBMS</h3>

<p>It is also possible to start an Okera catalog which shares the same RDBMS database as an existing Hive Metastore.
This is useful, for example, during migration to have the Okera catalog use the same underlying database as the existing Hive Metastore.
This allows the existing catalog information to be automatically visible through Okera.</p>

<p>To do so, configure <code class="highlighter-rouge">OKERA_DB_URL</code> (when starting up the Deployment Manager) to be the same database instance (MySQL server) as the one used by the existing Hive Metastore
Then, when creating the cluster, specify <code class="highlighter-rouge">--hmsDbName</code> and/or <code class="highlighter-rouge">--sentryDbName</code> when creating the cluster from the CLI.
Note that either or both can be specified - if not set, the values are derived from the cluster name.</p>

<p><strong>Example:</strong> Pointing an existing Okera cluster to the Hive Metastore in <code class="highlighter-rouge">env.sh</code></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OKERA_DB_URL</span><span class="o">=</span>hms.db.mycompany.com:3306
</code></pre></div></div>

<p><strong>Example:</strong> Creating a cluster with metadata in hive_db</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters create <span class="nt">--hmsDbName</span><span class="o">=</span>hive_db <span class="nt">--name</span><span class="o">=</span>fintech_prod <span class="nt">--numNodes</span><span class="o">=</span>1 <span class="nt">--type</span><span class="o">=</span>STANDALONE_CLUSTER <span class="nt">--environmentid</span><span class="o">=</span>1
</code></pre></div></div>

<h3 id="jwt">JWT</h3>

<p>JWT enabled clusters can optionally set these configurations to fine tune the service scalability.
These configs can be set using the DeploymentManager advanced configuration environment variable <code class="highlighter-rouge">SERVICE_ENVIRONMENT_CONFIGS</code>.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">OKERA_EXTERNAL_JWT_AUTH_SERVER_CACHE_TTL_MS</code></p>

    <p>Time, in milliseconds, to cache valid tokens.
If the token is presented again in this window, it will be accepted without reauthenticating it.
This can be used to dramatically reduce load on the JWT authentication service.
Be default, this is disabled (set to 0).</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">OKERA_EXTERNAL_JWT_AUTH_SERVER_TIMEOUT_MS</code></p>

    <p>Time, in milliseconds, to wait before timing out a JWT token authentication call if configured to authenticate against an external server.
This value defaults to 5000 (5 seconds).</p>
  </li>
</ul>

<p>As an example, to cache a token for 300 seconds and set the timeout to 10 seconds, set in <code class="highlighter-rouge">/etc/okera/env.sh</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">SERVICE_ENVIRONMENT_CONFIGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SERVICE_ENVIRONMENT_CONFIGS</span><span class="s2">;OKERA_EXTERNAL_JWT_AUTH_SERVER_CACHE_TTL_MS=300000"</span>
<span class="nb">export </span><span class="nv">SERVICE_ENVIRONMENT_CONFIGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SERVICE_ENVIRONMENT_CONFIGS</span><span class="s2">;OKERA_EXTERNAL_JWT_AUTH_SERVER_TIMEOUT_MS=10000"</span>
</code></pre></div></div>

<h2 id="external-kubernetes-cluster">External Kubernetes Cluster</h2>

<blockquote>
  <p><strong>Note:</strong> This feature is currently in beta</p>
</blockquote>

<p>The DeploymentManager supports installing ODAS services on an externally managed kubernetes cluster.
In this case, the user provides the DeploymentManager that cluster’s kubernetes configuration file.
The DeploymentManager no longer participates in the clusters machine’s management in any way.
This can be used for example, if there is an existing kubernetes cluster which can also be running non-ODAS services.
The Kubernetes cluster can be managed or not, for example, running in your datacenter, Amazon’s Managed Kubernetes Service (EKS) or Azure’s Kubernetes Service (AKS).</p>

<p>These clusters can be created using <code class="highlighter-rouge">ocadm</code>.
In this configuration, it is not necessary to first create an environment.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters create <span class="o">[</span>standard arguments] <span class="nt">--existingCluster</span><span class="o">=[</span>Path to kubernetes cluster conf file]
</code></pre></div></div>

<p>For example:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters create <span class="nt">--name</span> odas <span class="nt">--type</span> STANDALONE_CLUSTER <span class="nt">--existingCluster</span> /etc/k8s.conf
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong> The conf files must end in .conf.</p>
</blockquote>

<h2 id="advanced-networking">Advanced Networking</h2>

<h3 id="configuring-the-ip-range-that-a-odas-cluster-should-use-for-internal-routing">Configuring the IP range that a ODAS cluster should use for internal routing</h3>

<p>Each Okera cluster configures a private network for communication within the cluster.
By default, Okera will use the <code class="highlighter-rouge">172.30.0.0/16</code> range for internal communication.
The environment variable <code class="highlighter-rouge">OKERA_CDAS_INTERNAL_NETWORK_IP_RANGE</code> on the Deployment Manager can be used to configure this setting.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>This IP address range is used only for communication within each Okera cluster.
External clients never connect to it and it does not have to be open on the network.
It is important that this range does not conflict with any other ranges.
For example it should not be a subset of the EC2 machine’s ip range.</p>
</blockquote>

<blockquote>
  <p><strong>Note</strong></p>

  <p>AWS attaches an HTTP server to every instance at IP address <code class="highlighter-rouge">169.254.169.254</code>.
You should never configure an internal network range that would overlap with that IP address.
If that occurs, then AWS libraries will not be able to query the HTTP server for the instance’s IAM credentials, precluding access to AWS resources.</p>
</blockquote>

<h3 id="okera-port-allocation">Okera Port Allocation</h3>

<p>Okera utilizes network ports for external (user-facing) and internal system communication.
This section outlines the default minimum port requirements for successful cluster functionality.</p>

<blockquote>
  <p><strong>Warning</strong></p>

  <p>Please note that for optimal cluster performance, it is assumed that all internal ports between cluster node instances are open.
If environment policy requires that only essential ports remain open, be aware that it is possible that the cluster may perform sub-optimally as the underlying Kubernetes and Docker layers are optimized over time.</p>
</blockquote>

<p>External ports to the Deployment Manager and other ODAS services are used for ODAS cluster and data administration.
It is assumed that these ports are available to administrative users.</p>

<h4 id="static-ports">Static Ports</h4>

<p>Okera reserves the following ports for Okera service functionality.
These ports are not user configurable and are required for cluster creation, management, and operation.</p>

<table>
  <thead>
    <tr>
      <th>Port</th>
      <th>Usage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">443</code></td>
      <td>Kubernetes Master Communication</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">6443</code></td>
      <td>Kubernetes API Server</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">6783</code></td>
      <td>Kubernetes Weave</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">8085</code></td>
      <td>Okera Master Host</td>
    </tr>
  </tbody>
</table>

<h4 id="customizable-ports">Customizable Ports</h4>

<p>Okera supports changing the following port assignments in the <code class="highlighter-rouge">/etc/okera/env.sh</code> configuration file for your environment’s Deployment Manager instance.</p>

<p>The table below lists the suggested port assignments as defined by Okera.
All port assignments listed below are optional, and any that are not explicitly assigned will be assigned by Kubernetes during cluster creation.</p>

<p>In the case that no ports are assigned, ports will be assigned in the 30000-32000 port range.
In cases where ports are partially assigned, Kubernetes will assign ports to the unassigned services in the port range between (1) the lowest-numbered port assignment and (2a) the highest-numbered assignment or (2b) 2000 ports from the lowest-assigned port – whichever range is larger.</p>

<p><strong>Example 1:</strong></p>
<ul>
  <li>Lowest configured port: <code class="highlighter-rouge">5000</code> (ODAS REST Server)</li>
  <li>Highest configured port: <code class="highlighter-rouge">10020</code> (Planner)</li>
  <li>Port range for possible assignment of non-assigned ports: <code class="highlighter-rouge">5000</code>-<code class="highlighter-rouge">10020</code></li>
</ul>

<p><strong>Example 2:</strong></p>
<ul>
  <li>Lowest configured port: <code class="highlighter-rouge">5000</code> (ODAS REST Server)</li>
  <li>Highest configured port: <code class="highlighter-rouge">5010</code> (Planner)</li>
  <li>Port range for possible assignment of non-assigned ports: <code class="highlighter-rouge">5000</code>-<code class="highlighter-rouge">7000</code></li>
</ul>

<p>External ports are required for user administration as well as cluster creation, maintenance, and usage.</p>

<table>
  <thead>
    <tr>
      <th>Port</th>
      <th>Usage</th>
      <th>Access</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">5000-13050</code></td>
      <td>Kubernetes Dynamic Range</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">5000</code></td>
      <td>ODAS REST Server</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">11050</code></td>
      <td>Okera Planner Web UI</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">10001</code></td>
      <td>Kubernetes Web UI</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">10000</code></td>
      <td>Grafana Dashboard UI</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">8083</code></td>
      <td>Okera Web UI</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">9098</code></td>
      <td>Okera Canary</td>
      <td>internal</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">11060</code></td>
      <td>Sentry</td>
      <td>internal</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">11061</code></td>
      <td>Okera HMS</td>
      <td>internal</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">12050</code></td>
      <td>Planner</td>
      <td>external</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">13050</code></td>
      <td>Okera Worker</td>
      <td>external</td>
    </tr>
  </tbody>
</table>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2018 Okera, Inc. All rights reserved.  Site last generated: Sep 8, 2018
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
