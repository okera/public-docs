<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Cluster Sizing Guide | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing Okera</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Overview</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="awsguide">AWS Guide</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="standalone-jdbc-cluster">Standalone JDBC Cluster</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="cluster-sizing">Cluster Sizing</a></li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="third-party-integration">Integration Overview</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">REST API Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">AWS EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">Cloudera CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="databricks-integration">Databricks Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Hadoop Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Hive and Spark Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
          
          
          <li><a href="aws-cloudtrail-integration">AWS CloudTrail Integration Quick Start</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization-abac">Attribute-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="workspace-page">Workspace</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="data-registration">Data Registration</a> </li>
          
          
          
          
          
          
          <li><a href="managing-tags">Managing Tags</a> </li>
          
          
          
          
          
          
          <li><a href="autotagging-configuration">Configuring Auto-Tagger</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="cluster-sizing-guide">Cluster Sizing Guide</h1>

<p>The purpose of this document is to help in planning for the resources needed to run an Okera cluster.
It is useful for system architects and related roles that are responsible for determining how many servers are needed for a ODAS setup, and the respective size of these machines in respect to their role.</p>

<!-- TOC depthFrom:1 depthTo:3 withLinks:1 updateOnSave:0 orderedList:0 -->

<ul>
  <li><a href="#general-information">General Information</a>
    <ul>
      <li><a href="#cluster-host-roles">Cluster Host Roles</a></li>
      <li><a href="#cluster-technical-roles">Cluster Technical Roles</a></li>
      <li><a href="#cluster-node-types">Cluster Node Types</a></li>
    </ul>
  </li>
  <li><a href="#cluster-types">Cluster Types</a>
    <ul>
      <li><a href="#proof-of-conceptdevelopment-environment-pocdev">Proof-of-Concept/Development Environment (PoC/DEV)</a></li>
      <li><a href="#production-environment-prod">Production Environment (PROD)</a></li>
    </ul>
  </li>
  <li><a href="#cloud-providers">Cloud Providers</a>
    <ul>
      <li><a href="#amazon-web-services">Amazon Web Services</a></li>
    </ul>
  </li>
</ul>

<!-- /TOC -->

<h2 id="general-information">General Information</h2>

<p>An Okera ODAS cluster is foremost a data-access platform.
It has active components that run on managed hosts.
Some of these components handle metadata, such as database and dataset information, access policies and cluster state.
Some perform data processing and migration between storage backends and frontend consumers.</p>

<p>Operation of a ODAS cluster is mostly automated, with a management and orchestration layer, and the actual ODAS services hosted within.</p>

<h3 id="deployment-manager-dm">Deployment Manager (DM)</h3>

<p>This service bootstraps the rest of the ODAS cluster.
It has requirements to store the managed cluster details into a relational database.
The DM then installs the ODAS software artifacts on the remaining cluster machines.
If necessary, and used in the case of infrastructure-as-a-service (IaaS) providers, the DM is also responsible for executing an instance-provisioning script, which typically use the providers’ command-line tools to bring up the necessary infrastructure.</p>

<p>One instance of the DM can manage multiple ODAS clusters.</p>

<h3 id="cluster-host-roles">Cluster Host Roles</h3>

<p>Each host in the cluster is responsible to run one or more of several roles.
Likewise, some role services, such as Planner and Worker, run on all cluster nodes.</p>

<h4 id="okera-catalog">Okera Catalog</h4>

<p>The Catalog is required to serve the database and dataset information, including the dataset schemas and access policies.
All of this information is stored in a related database and served internally to the remaining ODAS components as necessary.</p>

<h4 id="odas-planner">ODAS Planner</h4>

<p>The Planner receives the initial request to process a query.
It uses the Catalog and cluster information to generate a plan which can be distributed and executed across the ODAS worker machines.
The Planner is lightweight in comparison and does not handle any data from the available datasets.</p>

<h4 id="odas-worker">ODAS Worker</h4>

<p>The worker role is responsible for the heavy lifting.
It moves data between the calling client and the federated storage systems that underlie the platform.
No data is stored on disk during this task, leaving the onus on network, memory, and CPU resources.</p>

<h4 id="odas-rest-service">ODAS REST Service</h4>

<p>This service provides access for non-native clients and Okera’s own Web UI to internal resources, such as the Catalog.
The REST service responds to an API that allows HTTP clients to access datasets.
This is not the recommended way for high-throughput data processing; it is most suited for accessing or updating the Catalog metadata.</p>

<h4 id="odas-web-ui">ODAS Web UI</h4>

<p>The Web UI provides access to the Catalog information, and enables users to discover and browse databases and datasets.
It is an interactive tool that is mostly concerned with metadata.</p>

<h3 id="cluster-technical-roles">Cluster Technical Roles</h3>

<p>Other node roles are required to orchestrate a ODAS cluster.
None of the these roles is part of the data path.
Therefore, they require only moderate resources.</p>

<h4 id="kubernetes-master">Kubernetes Master</h4>

<p>The ODAS roles are managed by Kubernetes, a tool for automated deployment, scaling, and management of containerized applications.
It has a master/worker architecture, where the master is responsible for the so-called <strong>Kubernetes control plane</strong>, which is the main controlling unit of the managed machines.
The master provides essential services, such as the controller manager, scheduler, and REST API server.</p>

<h4 id="kubernetes-worker">Kubernetes Worker</h4>

<p>The worker role is where the ODAS components are hosted.
That is, based on the scheduling and assignment of the Kubernetes master, the worker nodes will execute the containerized services provided by ODAS.
All cluster services (everything except the Deployment Manger) run on the Kubernetes workers.</p>

<h4 id="canary">Canary</h4>

<p>ODAS also comes with its own monitoring for service availability and status.
The Canary role is an auxiliary service that knows how to check the main ODAS services.
It is responsible for updating the Deployment Manager regarding the status of all managed ODAS clusters.</p>

<h4 id="zookeeper">ZooKeeper</h4>

<p>Finally, for various services there is a need to employ a distributed and reliable consensus and membership subsystem, which is provided by ZooKeeper.</p>

<h3 id="cluster-node-types">Cluster Node Types</h3>

<p>Since the above roles are assigned to shared nodes, we can combine the resource
requirements into the following major classes:</p>

<h4 id="deployment-manager-dm-1">Deployment Manager (DM)</h4>

<p>This is a host for the Deployment Manager role.
One DM instance can manage multiple ODAS clusters.
It is not actually part of the cluster, and it is not a resource-intensive application.</p>

<p><strong>Requirements:</strong></p>
<ul>
  <li>Moderate resources</li>
  <li>Database access</li>
</ul>

<h4 id="kubernetes-master-km">Kubernetes Master (KM)</h4>

<p>Also a single role machine, hosting the Kubernetes control plane.</p>

<p><strong>Requirements:</strong></p>
<ul>
  <li>Moderate resources</li>
</ul>

<h4 id="worker-node-worker">Worker Node (Worker)</h4>

<p>These machines run all the remaining roles, as scheduled and assigned by the Deployment Manager and Kubernetes master subsequently.</p>

<p><strong>Requirements:</strong></p>
<ul>
  <li>Elevated resources</li>
  <li>Database access for certain roles (ODAS Catalog)</li>
</ul>

<p>Dependent on the use of IaaS, for example in form of a cloud provider, or bare metal, the node types require specific features.
This includes, but is not limited to, number of CPUs and cores, network bandwidth and connectivity, storage capacity and throughput, and available main memory.</p>

<p>Most node types require only moderate resources, and it is often enough to ensure that any possible virtualization (for example, when running a cloud environment) is not causing any undue strain on the basic resources.
An exception to the rule is the worker, which needs memory when executing server-side joins (see <a href="supported-sql">Supported SQL</a> for details on what joins are executed within ODAS).
These joins need to load the joined table into memory, <em>after</em> any projection and filtering of that table has taken place.</p>

<p>For example, assume you have a table with 100 million rows and 100 columns that is used to filter records from other user tables.
Further assume a particular join is reducing the number of rows of the filter table to one million and the column count to two as part of the <code class="highlighter-rouge">JOIN</code> statement in the internal Okera view.
One of the columns is a LONG data type with 4 bytes, while the other column is a STRING with an average length of 10 bytes.
You will need 1M * (4 + 10) bytes, or roughly 14MB for the filter table in the worker memory.</p>

<p>In addition, if you are running about 10 queries concurrently, using the same filter table and assumed projection and filtering applied to it, then you will need 10 * 14MB, or 140MB of available memory on each worker machine.
(This assumes all workers are equally used in the query execution).</p>

<p>The default memory per worker per query is set to 128MB, which suffices in this example, though the concurrency is driving the combined memory usage up.
The more concurrent queries you are running on a worker, the more memory is needed.</p>

<h2 id="cluster-types">Cluster Types</h2>

<p>Broadly speaking, in practice there are often two types of environments set up with and for ODAS nodes.
Development and testing implementations use minimal resources, while production environments maximize resource allocation and utilization in line with business goals.</p>

<h3 id="proof-of-conceptdevelopment-environment-pocdev">Proof-of-Concept/Development Environment (PoC/DEV)</h3>

<p>Typically, minimal resources are assigned to a development or testing environment.
For provisioning that assigns coarser-grained resource classes, it is important to not under-provision the system resources.
For example, it has been observed that using a shared development database with heavily limited concurrent connection may cause I/O errors that may severely reduce the ODAS functionality, or could lead to service outages.</p>

<h3 id="production-environment-prod">Production Environment (PROD)</h3>

<p>The resources needed for production are a factor of the requirements of the business users.
In other words, each resource has a certain maximum capacity, and only parallelization is going to solve this limitation.
Each node should not be overloaded, either.
That is, its workload should only use up to 80% of the theoretical maximum, leaving crucial resources for the operating system itself.
Otherwise, the node could become unresponsive or fail completely.</p>

<p>Conversely, assigning too many resources may drive up cost, which is most likely a cause for concern in the long term.</p>

<p>We will discuss the various offerings and resource types below in the context of these cluster types, setting boundaries for allocation ranges (where applicable).</p>

<h2 id="cloud-providers">Cloud Providers</h2>

<p>Cloud providers typically do not offer configuration of the low-level system resources directly, such as for memory or CPU cores.
Instead they bundle these attributes into some kind of resource classes.
For example, the selection of a (virtual) server type will define the available level of the essential system resources implicitly.</p>

<p>Commonly for cloud services, compute and storage (which includes object and database storage) features are configured separately.
Furthermore, other related resources, such as load balancing or DNS, can be configured as needed.
For the purpose of this document, we will primarily look into compute and storage resources but mention others where necessary.</p>

<p>For now, the only cloud-services provider explored here is Amazon’s AWS suite.</p>

<h3 id="amazon-web-services">Amazon Web Services</h3>

<p>Amazon Web Services (AWS) is well known for a plethora of hosted offerings, making it a popular choice for companies and enterprises that want to forfeit on managing their own IT resources, or where the pace of innovation has overtaken the internal procurement and provisioning cycles.
Spinning up virtual machines is available at the click of a button in EC2, AWS’s <em>Elastic Compute Cloud</em> product.</p>

<p>Regarding ODAS, it is important to select the appropriate EC2 instance types for the mentioned cluster and node types.
This way, low-intensity resources are available either at a minimal level, or are not wasted due to over-provisioning.
The selection also varies based on the environment ODAS is installed into.</p>

<p>The following discusses compute and storage requirements separately.</p>

<h4 id="compute-instance-types">Compute Instance Types</h4>

<p>For production-level ODAS clusters on EC2, the following is recommended (especially for cluster nodes):</p>

<p><strong>Hardware Virtual Machines (HVM):</strong> Select instance types and AMIs that use
   <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/virtualization_types.html"><em>HVM virtualization</em></a>
   instead of the slower paravirtual machine (PV) option.</p>

<p><strong>Avoid EBS Only:</strong> For lowest latencies, don’t rely exclusively on Amazon’s Elastic Block Store.
Use instance types that have local storage – solid-state drives (SSD) in most cases.
This will reduce for any operating system-level tasks to have an impact on ODAS services.</p>

<p><strong>Placement Groups:</strong> Put all instances into a <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html"><em>Placement Group</em></a>,
  which optimizes the network connectivity between those nodes. While instances usually observe up to 10Gbps, placing the instances into a placement group, up to 25Gbps are possible.</p>

<p><strong>Enhanced Networking:</strong> Use instance types that allow to make use of <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/enhanced-networking.html"><em>Enhanced Networking</em></a>, which improves on the observed packet per second (PPS) performance, and lowers network jitter and latencies.</p>

<p><strong>S3 Storage:</strong> From a cost/performance standpoint, using the AWS <em>Simple Storage Service</em> (S3) is the best option.
Using instance storage, like EBS or ephemeral storage, is imposing more risk of complicating data management, compared to the disadvantage of S3 being slightly slower.
Tests have shown that S3 can be read at 600 MB/s per EC2 instance.
This is 60% of the theoretical limit of a 10GigE network uplink.</p>

<p>As far as ODAS using EC2 is concerned, worker nodes require larger <code class="highlighter-rouge">JOIN</code> operations to have access to as much memory as possible, especially for situations where concurrency is high (that is, many queries being executed at the same time).
The <strong>M5</strong> class EC2 instances, while always using EBS as their instance storage, can be sufficiently scaled to accommodate these requirements.
In addition, the EBS connectivity is optimized and better than other instance/EBS combinations.</p>

<p>Conversely, the <strong>M3</strong> class instances, which offer SSD instance storage, are limited in their total memory to only 30GB, which is too restrictive.
They also do not support enhanced networking.</p>

<p>Another option are the <strong>R3/R4</strong> type instances.
These are memory-optimized and scale up to 488GB of memory.
The <code class="highlighter-rouge">r4.2xlarge</code> and <code class="highlighter-rouge">r4.4xlarge</code> types are a good starting point for production clusters, giving ODAS twice the amount of memory over the M5 types with the same number of cores.</p>

<p>On the other hand, the <strong>C5</strong> class types place an emphasis on more cores to memory.
They shift the ratio the other direction, giving half as much memory compared to M5 instances with the same number of cores.</p>

<p>For ODAS, most of the work done is network based, which means that CPU cores are important, but so is memory for caching of intermediate data in memory.</p>

<p>As a starting point, we offer the following recommendations.</p>

<h5 id="pocdev-cluster">PoC/DEV Cluster</h5>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Service</th>
      <th>Node Type</th>
      <th>Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>DM</td>
      <td>t2.medium</td>
    </tr>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>Worker</td>
      <td>t2.xlarge</td>
    </tr>
  </tbody>
</table>

<h5 id="prod-cluster">PROD Cluster</h5>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Service</th>
      <th>Node Type</th>
      <th>Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>DM</td>
      <td>m5.xlarge</td>
    </tr>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>Worker</td>
      <td>m5.2xlarge</td>
    </tr>
  </tbody>
</table>

<p>This setup offers the option to increase (or decrease) the instance sizes or switch to a more memory- or core-heavy instance type.</p>

<h4 id="storage-instance-types">Storage Instance Types</h4>

<p>In practice, most data lakes in AWS follow the above recommendations and use S3 as their storage layer.
The additional advantage is that you can suspend or stop the compute resources at any time, for the purpose of saving cost without the danger of losing data, or so it can be accessed without a running compute cluster.</p>

<p>The following lists the common choices for both compute local (albeit being network-attached storage) and database related instance types.</p>

<p><strong>Ephemeral instance storage:</strong> The local filesystem in an instance is only used by the operating system.
Should an instance fail, its ephemeral storage is reset on restart (hence the name).</p>

<p><strong>Elastic Block Store (EBS) instance storage:</strong> For persistent storage across EC2 instance restarts, EBS is commonly used to attach storage containers that hold their data until they are permanently deleted.
EBS is often used as scratch space for running instances and the services they host.
Some EC2 instances only support EBS volumes, in which case it is the only option to run such a virtual machine.</p>

<p>As discussed earlier, when the utmost performance is wanted, choose an EC2 instance that supports SSD-backed EBS volumes and offers EBS-optimized network connectivity.</p>

<p><strong>Simple Storage Service (S3) instance storage:</strong></p>

<p>As discussed above, S3 is a separate, object-store-based service that can act as a storage source and target for EC2 instances.
The difference is that S3 can be accessed by other services too, without the need to run any additional compute resources.
S3 itself comes in two types: the standard offering and a version optimized for longterm storage.
Only the former is recommended as far as ODAS is concerned.</p>

<p><strong>Relational Database Service (RDS) for DB storage:</strong></p>

<p>The number of concurrent connections to an RDS instance is determined by the amount of memory the underlying EC2 instance has.
In more general terms, RDS is using EC2 virtual machines to provision a service, which is the difference between IaaS (infrastructure-as-a-service) and PaaS (platform-as-a-service).
Since concurrent connections to a database require a certain amount of memory, the available EC2 memory is used to compute the maximum connection count at provisioning time.
It is possible to modify that setting for a given instance, for example increasing or decreasing it to match the requirements.
However, the side effects of doing so are not predictable, and therefore it is <em>not</em> recommended practice.</p>

<p>For example, an RDS <code class="highlighter-rouge">db.t2.small</code> instance, which is a based on <code class="highlighter-rouge">t2.small</code> EC2 instance, has 2 GB of memory available, limiting the number of connections to about 170.
The formula is documented and discussed online:</p>

<blockquote>
  <p><a href="https://serverfault.com/questions/862387/aws-rds-connection-limits">Serverfault</a>:
“The current RDS MySQL max_connections setting is default by
<code class="highlighter-rouge">{DBInstanceClassMemory/12582880}</code>, if you use <code class="highlighter-rouge">t2.micro</code> with 512MB RAM, the
max_connections could be (512 * 1024 * 1024)/12582880 ~= 40, and so on.”</p>
</blockquote>

<p>The recommendation is to determine the number of connections needed for a database instance (which includes any other shared usage) and select an instance type for RDS that allows for at least 1.5 times as many connections.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2019 Okera, Inc. All rights reserved.  Site last generated: May 28, 2019
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
