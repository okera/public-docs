<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Cluster Sizing Guide | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing Okera</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Overview</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="awsguide">AWS Guide</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="standalone-jdbc-cluster">Standalone JDBC Cluster</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="cluster-sizing">Cluster Sizing</a></li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="third-party-integration">Integration Overview</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">REST API Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">AWS EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">Cloudera CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="databricks-integration">Databricks Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Hadoop Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Hive and Spark Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="aws-cloudtrail-integration">AWS CloudTrail Integration Quick Start</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization-abac">Attribute-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="workspace-page">Workspace</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="data-registration">Data Registration</a> </li>
          
          
          
          
          
          
          <li><a href="managing-tags">Managing Tags</a> </li>
          
          
          
          
          
          
          <li><a href="autotagging-configuration">Configuring Auto-tagging</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Tutorials</a>
      <ul>
          
          
          
          <li><a href="onboarding-datasets">Onboarding datasets</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="cluster-sizing-guide">Cluster Sizing Guide</h1>

<p>Use this document to help plan the resources needed to run Okera clusters.
It is intended for system architects and those in related roles to determine the server size needed to run each ODAS component.</p>

<!-- TOC depthFrom:1 depthTo:3 withLinks:1 updateOnSave:0 orderedList:0 -->

<ul>
  <li><a href="#general-information">General Information</a>
    <ul>
      <li><a href="#management-services">Management Services</a></li>
      <li><a href="#user-services">User Services</a></li>
      <li><a href="#internal-services">Internal Services</a></li>
      <li><a href="#cluster-node-types">Cluster Node Types</a></li>
      <li><a href="#resource-requirements">Resource Requirements</a></li>
    </ul>
  </li>
  <li><a href="#cluster-environment-types">Cluster Environment Types</a>
    <ul>
      <li><a href="#proof-of-conceptdevelopment-environment">Proof-of-Concept/Development Environment</a></li>
      <li><a href="#production-environment">Production Environment</a></li>
    </ul>
  </li>
  <li><a href="#cloud-providers">Cloud Providers</a>
    <ul>
      <li><a href="#amazon-web-services-aws">Amazon Web Services (AWS)</a></li>
    </ul>
  </li>
</ul>

<!-- /TOC -->

<h2 id="overview">Overview</h2>

<p>While the remainder of this document is explaining the resource requirements regarding ODAS clusters in great detail, we start with a summary table.
The following instance types are recommended as starting points for your consideration:</p>

<p><strong>PoC/Development Cluster</strong></p>

<table>
  <thead>
    <tr>
      <th>Node Type</th>
      <th>AWS Instance Type</th>
      <th>Azure Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DM</td>
      <td><code class="highlighter-rouge">t2.medium</code></td>
      <td><code class="highlighter-rouge">Standard_B2s</code></td>
    </tr>
    <tr>
      <td>Worker</td>
      <td><code class="highlighter-rouge">t3.2xlarge</code> / <code class="highlighter-rouge">m5.2xlarge</code> / <code class="highlighter-rouge">c5.4xlarge</code></td>
      <td><code class="highlighter-rouge">Standard_B8ms</code> / <code class="highlighter-rouge">Standard_D8_v3</code> / <code class="highlighter-rouge">Standard_F16s_v2</code></td>
    </tr>
  </tbody>
</table>

<p>Note: Choose the larger worker types when your requirements for these clusters is expected to include performance assessments.</p>

<p><strong>Production Cluster</strong></p>

<table>
  <thead>
    <tr>
      <th>Node Type</th>
      <th>AWS Instance Type</th>
      <th>Azure Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DM</td>
      <td><code class="highlighter-rouge">t3.2xlarge</code></td>
      <td><code class="highlighter-rouge">Standard_B8ms</code></td>
    </tr>
    <tr>
      <td>Worker</td>
      <td><code class="highlighter-rouge">m5.4xlarge</code> / <code class="highlighter-rouge">c5.9xlarge</code></td>
      <td><code class="highlighter-rouge">Standard_D16_v3</code> / <code class="highlighter-rouge">Standard_F32s_v2</code></td>
    </tr>
  </tbody>
</table>

<h2 id="general-information">General Information</h2>

<p>Okera’s ODAS is a data access service built for distributed, scalable workloads.
It is comprised of multiple services that are deployed in Docker containers and orchestrated by Kubernetes.</p>

<p>Some components manage metadata, including database and dataset schema, or their access policies, or the state of the cluster itself.
Other components process client requests and facilitate data transfer from storage to the requesting clients.</p>

<p>Operation of an ODAS cluster is mostly automated, with a management and orchestration layer, and the actual ODAS services hosted therein.
The former can be managed by Okera itself or delegated to provided container-management services, such as AWS EKS or Azure AKS.</p>

<h3 id="management-services">Management Services</h3>

<p>When Okera is managing the container orchestration, it is using the following (optional) shared services.</p>

<p><strong>(Optional) Deployment Manager (DM)</strong> -
The Deployment Manager creates, monitors, manages, and deletes ODAS clusters.
It persists the configuration and state of each managed clusters to a relational database and installs ODAS components on the launched cluster nodes.
One DM instance can manage multiple ODAS clusters.</p>

<h3 id="user-services">User Services</h3>

<p>Each cluster host may run one or more of the following ODAS sub-services.
Some services, such as the ODAS Worker that handles task execution, run in multiples for greater parallelism and availability.
Others, such as the ODAS Planner, run in multiples to ensure continuity of service.</p>

<p><strong>Okera Catalog</strong> -
The ODAS Catalog serves database and dataset information, including schema definitions and access policies.
This information is backed by a relational database and is served directly to other ODAS components as needed.</p>

<p><strong>ODAS Planner</strong> -
The ODAS Planner receives data definition/manipulation/control language (DDL/DML/DCL) requests from clients.
For DML, as an example, it generates a plan, based on Catalog metadata, access and storage policies, and the cluster’s runtime resources, which is then distributed and executed across the available Workers.
The Planner is a relatively lightweight process; it does not process client data.</p>

<p><strong>ODAS Worker</strong> -
ODAS Workers execute tasks assigned by the Planner.
They transfer data from underlying storage to the calling client.
Workers do not store client data at any stage of query execution, and therefore rely on adequate network, memory, and CPU resources to complete each task.</p>

<p><strong>ODAS REST Service</strong> -
The REST service gives internal and external clients, including the Okera Web UI, access to ODAS resources through a collection of REST-based endpoints.
It is primarily intended for examining and updating Catalog metadata and so is not recommended for heavy workloads, such as scanning a large dataset.</p>

<p><strong>ODAS Web UI</strong> -
The Web UI offers HTTP-based access to the Catalog, giving lightweight users a way to discover and browse available databases and datasets.
It also provides limited support for test queries, discovery of new datasets, management of access policies, and usage reports.</p>

<h3 id="internal-services">Internal Services</h3>

<p>The internal services listed below coordinate and orchestrate user facing ODAS cluster services.
None of these services operate in the request path, and therefore do not require the same resources as a Worker.</p>

<p><strong>Kubernetes Master</strong> -
Kubernetes (K8s for short) is a service for managing the needs of containerized applications.
Its design follows the well-known master/worker paradigm, in which the master, or <strong>Kubernetes control plane</strong>, coordinates all machines put under its service.
The master includes a controller manager, a resource scheduler, and a REST API server.</p>

<p><strong>Kubernetes Worker</strong> -
Kubernetes workers (aka kubelet) are co-located with ODAS components.
Based on scheduling and other instructions from the K8s master, these workers operate directly on the containers that host ODAS services.
All ODAS services, except the Deployment Manager, rely on Kubernetes workers for operational resources.</p>

<p><strong>Canary</strong> -
The Canary monitors the cluster for ODAS service availability and status.
It is polled regularly by the Deployment Manager to detect any state changes to cluster services.</p>

<p><strong>ZooKeeper</strong> -
ODAS uses ZooKeeper to provide membership, consensus, and task coordination services to the roles that need it.
While it is very light on system resources, it depends on as little contention for disk access as possible to guarantee good service.</p>

<h3 id="cluster-node-types">Cluster Node Types</h3>

<p>Many of the ODAS services listed above are co-located with other services on specific compute nodes.</p>

<p><img src="assets/images/k8s-simple.png" alt="Cluster Node Types" title="Cluster Node Types" style="width: 100%; max-width:100%;" /></p>

<p>We describe their resource requirements with that in mind:</p>

<p><strong>(Optional) Deployment Manager (DM)</strong> -
The Deployment Manager operates on a standalone host, as it is designed to manage multiple ODAS clusters from a single point.
It uses a database as a backing store for ODAS cluster configurations and state updates.
As a standalone admin component, it requires relatively modest memory, CPU, and storage resources.</p>

<p><strong>Kubernetes Master (KM)</strong> -
In a production cluster, the KM service would normally run standalone.
For a proof-of-concept (PoC) or light-duty workloads, it can be co-located with ODAS services as its resource requirements are also low for CPU, memory, and storage.</p>

<p><strong>Worker Node (Worker)</strong> -
These machines run all the remaining services, as scheduled and assigned by the Deployment Manager (for Okera managed clusters) and Kubernetes master subsequently.
The resources needed by the Okera services, especially the ODAS Workers are high in comparison and will use as much CPU, memory and network I/O as possible to fulfill the current workloads.
The node also runs the K8s worker (aka kubelet) service, which itself does not demand many resources.
Note that some ODAS components, such as the Catalog services, require access to a database to persist and read their state.</p>

<h3 id="resource-requirements">Resource Requirements</h3>

<p>Dependent on the use of IaaS, for example in form of a cloud provider, or bare metal, the node types require specific resources.
This includes, but is not limited to, number of CPUs (or cores), network bandwidth and connectivity, storage capacity and throughput, and available system memory.
In practice, the mentioned nodes types fall into two categories, non-worker and worker nodes, with their requirements discussed in the next two subsections.</p>

<h4 id="non-worker-node-requirements">Non-Worker Node Requirements</h4>

<p>Non-worker node types require only moderate resources, and it is often enough to ensure that any possible virtualization (for example, when running in a cloud environment) is not causing any undue strain on the basic resources.</p>

<h4 id="worker-node-requirements">Worker Node Requirements</h4>

<p>For worker nodes, the requirements in more detail are:</p>

<p><strong>CPU</strong> - Workers executing user queries need enough CPU to handle server-side functionality, including decompression of data, built-in and user-defined functions, I/O handling, and so on.
Okera’s server code is highly efficient and optimized for these tasks, usually putting only medium strain on the CPU.</p>

<p><strong>Network I/O</strong> - Since Okera sits in between the data and consumers, the major focus for resources is network I/O, especially in cloud environments, where data resides in network-attached storage services.
Okera recommends that network resources should not be artificially limited, for example, through throttling by the infrastructure provider (as may happen with small instance sizes in cloud services).</p>

<p><strong>Disk</strong> - Workers do not persist data to local (or attached) disks.
In other words, Okera requires only a marginal amount of local disk as all query data is streamed through network and memory only.
The bulk of its disk requirements come from the binary container images stored locally on each node.
Okera recommends disk space of around 30-40 GB to be available.</p>

<p><strong>Memory</strong> - Apart from general usage, there are two places where Okera requires a flexible amount of memory on worker nodes: per-query data structures and cache.
These are discussed in the following subsections.
For functional testing and development 16 GB of memory should be viable.
For all production use of Okera, the memory provided should start at 32 GB.</p>

<h5 id="query-concurrency">Query Concurrency</h5>

<p>By default, each ODAS Worker process can handle up to 500 concurrent requests.
This does not necessarily mean 500 separate users, since larger queries are split into many smaller tasks and distributed across the server, but up to 500 concurrent tasks that are executed.
For task ordering across users, the ODAS Worker relies on the downstream compute engine to schedule these tasks according to the configured rules.</p>

<p>In general, the default maximum memory per worker per query is set to 128 MB, which means concurrency is driving the combined memory usage up.
The more concurrent queries you are running on a worker, the more memory is needed.
If a query fails to allocate enough memory it is aborted and an error is reported to the user.</p>

<h5 id="general-memory-requirements">General Memory Requirements</h5>

<p>For regular queries that do <em>not</em> contain <code class="highlighter-rouge">JOIN</code>’s executed by Okera (see next section), the memory requirements are fairly low, as the server processes need just enough to handle the streaming data for all concurrently running queries (plus some internal data structures and so on).
This includes the memory needed to load the raw data from storage in small chunks, as well as the structures to unpack the data into batches of rows.
For every row, the servers need as much memory for the latter as is required by the query, based on the projection; for instance, a <code class="highlighter-rouge">SELECT * FROM table</code> will need memory for all column types of the schema, while a <code class="highlighter-rouge">SELECT ID FROM table</code> will only need 4 bytes (assuming ID is an <code class="highlighter-rouge">INT</code> type).
On average, the memory per query should be in the low megabyte range.</p>

<p>However, Okera also caches table data read from object storage systems (such as AWS S3) which means you should observe the memory usage of a worker node pegged at some higher steady state in practice.
This normal and expected.</p>

<p>Memory usage varies also based on the dataset metadata, with partitioned tables with complex schemas requiring more compared to more simple schemas.
Okera recommends a partitioning schema that strikes a good balance between per-partition size and number of partitions.
In practice, a <em>daily</em> partitioning seems a good starting point for sources that produce data in the low gigabyte range per-day (up to 10 GB).</p>

<p>Okera recommends at least 32 GB of memory for average concurrency (lower tenths), leaving enough memory for the caching to be effective.
You will have to increase memory when the concurrency is very high (hundred of concurrent queries being executed).</p>

<h5 id="memory-requirements-for-joins-handled-by-okera">Memory Requirements for JOINs handled by Okera</h5>

<p>An exception to the general memory requirements mentioned are executing server-side joins (see <a href="supported-sql">Supported SQL</a> for details on what joins are executed within ODAS).
These joins need to load the joined table into memory, <em>after</em> any projection and filtering of that table has taken place.</p>

<p>For example, assume a table with 100 million rows and 100 columns that is used as a filter against other data tables.
Further assume a particular join is reducing the number of rows of the filter table to one million and the column count to two as part of the <code class="highlighter-rouge">JOIN</code> statement in the internal Okera view.
One of the columns is an <code class="highlighter-rouge">INT</code> data type with 4 bytes, while the other column is a <code class="highlighter-rouge">STRING</code> with an average length of 10 bytes.
You will need 1M * (4 + 10) bytes, or roughly 14MB for the filter table in the worker memory.</p>

<p>In addition, if you are running about 10 similar queries concurrently, using the same filter table and assumed projection and filtering applied to it, then you will need 10 * 14MB, or 140MB of available memory on each worker machine, assuming all workers are equally used in the query execution.</p>

<p>The default memory per worker per query of 128 MB suffices in this example, though the concurrency is driving the combined memory usage up.
You need to carefully monitor the memory usage using the provided service metrics and adjust as necessary.</p>

<h2 id="cluster-environment-types">Cluster Environment Types</h2>

<p>The most common configuration types for ODAS clusters are for either proof-of-concept (PoC), development-only, or production environments.
The first two types are used to prove a cluster’s function and capability and so require
modest resources.
Production environments must be sized to meet stated business goals and requirements, which can vary by use case, concurrency, and data set size.
The following sections discuss the two environment types in more detail.</p>

<h3 id="proof-of-conceptdevelopment-environment">Proof-of-Concept/Development Environment</h3>

<p>Although a development or test environment can run on a modest allocation of resources, underestimating the memory and network resources to transfer data can still lead to sluggish or failed operation.
Okera does observe cases where a shared development database with few concurrent connections, for example, times out frequently, triggering I/O errors that affect the cluster’s ability to respond to its users.
Query failures can also result from workers being unable to communicate with their master or supervisor processes.</p>

<h3 id="production-environment">Production Environment</h3>

<p>Sizing and selecting the resources needed for production depends on the factors, requirements, and constraints the business user knows best.
When in doubt, it makes sense to start by understanding the concurrent demand for access and the size as well as complexity of the data sets in use.</p>

<p>As a general rule, the expected workload should not exceed certain system resources to ensure there will be sufficient spare capacity for the operating system and to allow for spikes on demand.
ODAS components rely heavily on a distributed collection of services.
Chronic saturation by user demand can cause timeouts, which leads to task or job failures.
Oversizing the resources can, of course, lead to cost overages.</p>

<p>In general terms, Okera recommends to pair the ODAS resources with those used in the downstream compute clusters.
This means, given a node type with a certain amount of CPU cores, you should use the same type for both the compute and Okera nodes, choosing a node count ratio between the compute and ODAS clusters providing the necessary resources for the given workloads.
Since ODAS clusters are often network bound due to the fact that all heavy computing (such as aggregations) is done in the client compute clusters (such as Presto, Hive or Spark), Okera is recommending the following ratios:</p>

<ul>
  <li>
    <p><strong>Batch Workloads:</strong> A 10:1 ratio is recommended as a starting point.
That means, for every 10 compute nodes have one ODAS worker node with the same specifications.</p>
  </li>
  <li>
    <p><strong>Interactive Workloads:</strong> A starting ratio of 4:1 is recommended for more MPP-style, ad-hoc query engines that promise low-latencies to their users (for example Presto).</p>
  </li>
</ul>

<p>After monitoring the vitals of the ODAS cluster serving either workload and assuming you see less than 50-60% load you can increase the ratio to a higher number, for example 20:1 for batch and 10:1 for interactive workloads.</p>

<p>We will discuss the various resource types below in the context of the mentioned cluster types, setting boundaries for allocation ranges (where applicable).</p>

<h2 id="cloud-providers">Cloud Providers</h2>

<p>Cloud providers offer a range of pre-configured instance types that address well-known, general workload constraints (for instance, compute-bound or I/O-bound).
In addition, compute and storage resources are modelled as standalone services.
Core services, such as network load-balancing or DNS, are often represented as a service on top of a selected compute service (that is, not completely elastic to workload).
Below we describe the vendor-specific compute and storage resources available in detail, and mention so-called support services as needed.</p>

<h3 id="amazon-web-services-aws">Amazon Web Services (AWS)</h3>

<p>AWS offers a catalog of services that appeals to many companies and enterprises looking to migrate their applications to the cloud.
The pace of AWS’ innovation, the time saved in bypassing internal procurement and provisioning processes, and the flexibility of a la carte services can be an attractive alternative to on-prem
deployment.
In AWS, any customer can create and run a virtual machine with a few button clicks.
AWS calls their virtual machine service the Elastic Compute Cloud, or EC2 for short.</p>

<p>To run ODAS well, it’s essential to pick EC2 types that are well-suited to their intended workload.
Below we offer some general advice on ODAS compute and storage requirements.</p>

<h4 id="compute-instance-types">Compute Instance Types</h4>

<p>For production-level ODAS clusters using EC2, we favor the following attributes in instance types:</p>

<p><strong>Local Storage:</strong> Although AWS Elastic Block Store (EBS) is inexpensive to use, it is not a low-latency option.
Consider instance types that support a local storage option, in particular solid-state drives (SSD), to mitigate this constraint.
This storage type will also reduce the impact an operating system’s workload may have on the hosted application’s resource needs.</p>

<p><strong>Placement Groups:</strong> Consider putting all instances for a cluster into one <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html"><em>Placement
Group</em></a> to optimize for network connectivity.
In this configuration, you can take advantage of EC2 instances that support 25Gbps of network bandwidth.</p>

<p><strong>Enhanced Networking:</strong> Instance types that support <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/enhanced-networking.html"><em>Enhanced Networking</em></a>, offer improved packet per second (PPS) performance, lower network jitter, and less latency.</p>

<p>Note that ODAS clusters often run on the same instance types as your current compute needs, for example, the instance types used for your Hadoop or EMR infrastructure.
These are typically in the M5 or C5 classes.</p>

<p>As for instance types in general, the primary resource concern for data workloads is available memory, especially for joins handled by Okera and working data sets that are kept in memory by ODAS Workers.
And, as mentioned above, high concurrency needs go hand in hand with plenty of memory.</p>

<p>Then following classes of instance types are available in AWS EC2:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Class</th>
      <th style="text-align: center">Rec.</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">M</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: left">Balances memory and CPU cores</td>
    </tr>
    <tr>
      <td style="text-align: center">C</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: left">More CPU cores over memory</td>
    </tr>
    <tr>
      <td style="text-align: center">R</td>
      <td style="text-align: center">No</td>
      <td style="text-align: left">More memory over CPU cores</td>
    </tr>
    <tr>
      <td style="text-align: center">I</td>
      <td style="text-align: center">No</td>
      <td style="text-align: left">Optimized for local disk I/O</td>
    </tr>
  </tbody>
</table>

<p>Note: “Rec.” is short for “Recommended by Okera”</p>

<p>Given that compute engines often need a balance between memory and CPU, the <strong>M-class</strong> instance types are the recommended ones.
For example <code class="highlighter-rouge">m5.2xlarge</code> and <code class="highlighter-rouge">m5.4xlarge</code> are good initial choices for PoC and production clusters respectively.
Although M5 uses EBS for its instance storage, the type scales to accommodate many requirements.
Also, EBS connectivity for the M5 series is optimized and superior to other instance/EBS combinations.</p>

<p>The <strong>C-class</strong> types emphasizes cores over memory, offering half the memory of M5 types at the same number of cores.
For example, <code class="highlighter-rouge">c5.4xlarge</code> and <code class="highlighter-rouge">c5.9xlarge</code> are possible choices for production clusters.</p>

<p><strong>R-class</strong> types are memory-optimized, supporting up to 488GB of memory.
This is often not useful in practice, as workers eventually reach a steady state as far as memory is concerned, after which more memory is not required nor beneficial.</p>

<p>Finally, the <strong>I-class</strong> types are optimized to handle local I/O, such as SSDs, more efficiently.
As explained above, ODAS does not use disk for query execution, so extra optimization for local disk is not required.</p>

<p>When in doubt, establish a baseline with a small but viable instance.
We recommend at minimum the following:</p>

<p><strong>PoC/Development Cluster</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Service</th>
      <th>Node Type</th>
      <th>Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>DM</td>
      <td><code class="highlighter-rouge">t2.medium</code></td>
    </tr>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>Worker</td>
      <td><code class="highlighter-rouge">t3.2xlarge</code> / <code class="highlighter-rouge">m5.2xlarge</code> / <code class="highlighter-rouge">c5.4xlarge</code></td>
    </tr>
  </tbody>
</table>

<p>Note: Choose the larger worker types when your requirements for these clusters is expected to include performance assessments.</p>

<p><strong>Production Cluster</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Service</th>
      <th>Node Type</th>
      <th>Instance Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>DM</td>
      <td><code class="highlighter-rouge">t3.2xlarge</code></td>
    </tr>
    <tr>
      <td style="text-align: center">EC2</td>
      <td>Worker</td>
      <td><code class="highlighter-rouge">m5.4xlarge</code> / <code class="highlighter-rouge">c5.9xlarge</code></td>
    </tr>
  </tbody>
</table>

<p>Once you have some performance results, consider increasing or decreasing instance sizes accordingly, or switching to types with the memory, cores, or network capacity that are a better fit.</p>

<h4 id="storage-instance-types">Storage Instance Types</h4>

<p>In practice, most AWS-based data lake operators use S3 for their storage layer.
Using S3, you can stop or terminate compute resources to reduce cost without risk of data loss.
The data store is decoupled from compute and is always available; it does not depend on any client or other service for access.</p>

<p>The following pointers are widely used for compute-local and database-related instance types.</p>

<p><strong>Ephemeral Instance Storage:</strong> This instance-based storage is only used by the operating system and is cleared at the end of each session (hence the term ‘ephemeral’).</p>

<p><strong>Elastic Block Store (EBS) Instance Storage:</strong> EBS storage persists across EC2 instance restarts.
It is often used to keep data independently of the EC2 instance using it.
EBS volumes can also serve as scratch space for running instances and their hosted services.
Note that some EC2 instances only support EBS storage.</p>

<p>As discussed above, EC2 instances that support SSD-backed EBS volumes and EBS-optimized network connectivity offer the best performance profile.</p>

<p><strong>Simple Storage Service (S3):</strong></p>

<p>S3 is a standalone object store service.
Any client can access it directly.
It is available in two types: standard, and a version that has been optimized for long-term storage.
Only the standard service is recommended for use with ODAS.</p>

<p><strong>Relational Database Service (RDS) for DB Storage:</strong></p>

<p>The number of concurrent connections an RDS instance can support is limited by the memory available from its host EC2 instance.
RDS itself is not inherently elastic; you must choose the EC2 type to pair it with.
There is no straightforward or recommended way to modify available memory without changing the EC2 instance type.</p>

<p>For a sizing example, consider an RDS service running on a <code class="highlighter-rouge">db.t2.small</code> instance, which uses the <code class="highlighter-rouge">t2.small</code> EC2 type.</p>

<blockquote>
  <p><strong>Note:</strong> The example is using an instance type that is <em>not</em> recommended in practice.
  It is used for the sake of showing the effects of low memory on the connection limits.</p>
</blockquote>

<p>This type offers 2 GB of memory, which limits the number of concurrent RDS connections to about 170.
A rule-of-thumb formula is discussed here:</p>

<blockquote>
  <p><a href="https://serverfault.com/questions/862387/aws-rds-connection-limits">Serverfault</a>:
“The current RDS MySQL max_connections setting is default by
<code class="highlighter-rouge">{DBInstanceClassMemory/12582880}</code>, if you use <code class="highlighter-rouge">t2.micro</code> with 512MB RAM, the
max_connections could be (512 * 1024 * 1024)/12582880 ~= 40, and so on.”</p>
</blockquote>

<p>In general, it is recommended the EC2 instance type used for RDS has enough memory to allow 1.5x the connections required, which further assumes no other workloads will be present on the instance.
For example, an <strong>R-class</strong> type with at least 64 GB of memory is recommended.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2019 Okera, Inc. All rights reserved.  Site last generated: Aug 29, 2019
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
