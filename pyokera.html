<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>PyOkera | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing the Deployment Manager</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installing the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Okera Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting Up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting Up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="catalog-rest-api">REST API</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Client Configuration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">EMR Integration</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="pyokera">Native Python Integration</a></li>
          
          
          
          
          
          
          <li><a href="client-integration">Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="third-party-integration">Third-Party Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="pyokera">PyOkera</h1>

<p>PyOkera is the native Python library for clients interacting with ODAS. It is similar to the Java libraries and calls the lower level ODAS services.
The library directly interacts with the planner and worker services.
There are alternate ways it can interact with ODAS from Python.
In particular, it can interact by way of the REST API.
This library can provide more overall control and better performance.
For simple applications, the REST API may be sufficient.
We recommend this native library for reading larger volumes of data.</p>

<blockquote>
  <p><strong>Note:</strong> This library is currently in a preview phase.
The APIs are subject to change and the performance characteristics are not in their final state.</p>
</blockquote>

<h2 id="setup">Setup</h2>

<p>PyOkera requires ODAS 0.8.1 or greater.
If running against an older version, scans will fail with a message to upgrade the server.</p>

<h3 id="dependencies">Dependencies</h3>

<p>Required:</p>

<ul>
  <li>Python 3.4+.</li>
  <li>Linux: GCC (with C++ support)</li>
  <li>Packages:
    <ul>
      <li>easy_install</li>
      <li>pip</li>
      <li>six</li>
      <li>bit_array</li>
      <li>thriftpy</li>
      <li>numpy *</li>
      <li>pandas *</li>
    </ul>
  </li>
</ul>

<p>* These packages are required to use the scan APIs, but they are not required for the metadata-related APIs.</p>

<blockquote>
  <p><strong>Note:</strong> Python2 is not supported.
There are no plans to support it.</p>
</blockquote>

<h3 id="installing-from-pypi">Installing from PyPI</h3>

<p>The Python library is available on <a href="https://pypi.org/project/pyokera/">PyPI</a>.
It can be installed using pip.
Pip assumes that Python3 is already installed on the system.</p>

<ol>
  <li>Get pip.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://bootstrap.pypa.io/get-pip.py"</span> <span class="nt">-o</span> <span class="s2">"get-pip.py"</span>
</code></pre></div>    </div>
  </li>
  <li>Install pip.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>python3 get-pip.py
</code></pre></div>    </div>
  </li>
  <li>Install pyokera.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo pip3 install pyokera
</code></pre></div>    </div>
  </li>
  <li>Optionally install pandas by running:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pip3 install pandas
</code></pre></div>    </div>
    <p>To confirm that the install was successful, try importing it from the interpreter and getting the version.</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">okera.odas</span>
<span class="n">okera</span><span class="o">.</span><span class="n">odas</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
<span class="c"># Should output the version string, for example 1.2.3</span>
</code></pre></div>    </div>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> The pandas install can fail due to system dependencies.
For more information, see the <a href="https://pandas.pydata.org/pandas-docs/stable/install.html">pandas docs</a> or the docs below.</p>
</blockquote>

<h3 id="installing-with-easy_install">Installing with easy_install</h3>

<p>If PyPI or pip are not accessible on the network, it is possible to install the client from Okera’s release location in S3 using easy_install.
After installing the dependencies, perform the following steps.</p>

<ol>
  <li>Download the library.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-O</span> https://s3.amazonaws.com/okera-release-useast/1.2.3/client/pyokera.egg
</code></pre></div>    </div>
  </li>
  <li>Install the library.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>easy_install <span class="nt">--user</span> pyokera.egg
</code></pre></div>    </div>
    <ul>
      <li>Or, install system-wide.
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [sudo] easy_install pyokera.egg
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h3 id="full-dependency-installations">Full Dependency Installations</h3>

<p>Below are some examples of how to install the dependencies in two different Amazon Web Services (AWS) based environments.
Depending on your network restrictions, these may have to be adapted to use your package managers.</p>

<h4 id="full-installation-on-rhel7">Full Installation on RHEL7</h4>

<p>This assumes a minimal RedHat Enterprise Linux 7 or CentOS 7 machine.
For example, the base RHEL7 AMI on Amazon AWS.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Basic python install and dependencies, this satisfies the requirements.</span>
<span class="nb">sudo </span>rpm <span class="nt">-ivh</span> https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
<span class="nb">sudo </span>yum install <span class="nt">-y</span> gcc-c++ python34.x86_64 python34-devel
curl <span class="s2">"https://bootstrap.pypa.io/get-pip.py"</span> <span class="nt">-o</span> <span class="s2">"get-pip.py"</span>
<span class="nb">sudo </span>python3 get-pip.py
<span class="nb">sudo </span>pip3 install six bit_array thriftpy
curl <span class="nt">-O</span> https://s3.amazonaws.com/okera-release-useast/1.2.3/client/pyokera.egg
<span class="nb">sudo </span>easy_install pyokera.egg

<span class="c"># Optional packages (installing pandas can take a while)</span>
pip3 install Cython numpy pandas
</code></pre></div></div>

<h4 id="establishing-dependencies-on-amazon-emr">Establishing Dependencies on Amazon EMR</h4>

<p>These instructions install all dependencies on a fresh Amazon Elastic MapReduce (EMR) instance.</p>

<blockquote>
  <p><strong>Note:</strong> This instance typically has Python2 and Python3 installed. PyOkera is only supported for Python3.</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://bootstrap.pypa.io/get-pip.py"</span> <span class="nt">-o</span> <span class="s2">"get-pip.py"</span>
<span class="nb">sudo </span>python3 get-pip.py
<span class="nb">sudo</span> /usr/local/bin/pip3 install six bit_array thriftpy
curl <span class="nt">-O</span> https://s3.amazonaws.com/okera-release-useast/1.2.3/client/pyokera.egg
<span class="nb">sudo </span>easy_install-3.4 pyokera.egg

<span class="c"># Optional packages (installing pandas can take a while)</span>
<span class="nb">sudo</span> /usr/local/bin/pip3 install numpy pandas
</code></pre></div></div>

<h2 id="using-pyokera">Using PyOkera</h2>

<p>Once PyOkera is installed, development can begin.</p>

<p>The PyOkera API has its own <a href="https://cerebro-data.github.io/external-docs/index.html">documentation site</a>.
This includes docs for each of the APIs in detail.</p>

<h3 id="getting-started">Getting Started</h3>

<p>In a typical application, first create a context object.
The context object represents state that is shared between ODAS connections (and therefore also requests), including user credentials.
From the context object, users create connection objects, which can be used to execute DDL and scan requests against ODAS.</p>

<p>For further data manipulation, the library object provides utilities to read an entire dataset into pandas.</p>

<p>The following example reads the first dataset from the <code class="highlighter-rouge">okera_sample</code> database:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">list_dataset_names</span><span class="p">(</span><span class="s">'okera_sample'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scan_as_pandas</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="authentication">Authentication</h3>

<p>PyOkera supports authentication using Kerberos or tokens.
It also supports connecting to unauthenticated servers, which should only be used in development.
Authentication information is stored in the <code class="highlighter-rouge">context</code> object.</p>

<h3 id="no-configuration-specified">No Configuration Specified</h3>

<p>When the context object is created, it automatically configures token-based authentication or no authentication.
If a token for the current user is available (typically in <code class="highlighter-rouge">~/.okera/token</code>), then token auth is configured.</p>

<p><strong>Example:</strong> Configuring authentication</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">get_auth</span><span class="p">()</span> <span class="c"># Will be None or 'TOKEN'</span>

<span class="c"># To disable authentication:</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">disable_auth</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="enabling-token-auth">Enabling Token Auth</h3>

<p>To set the user token, call <code class="highlighter-rouge">enable_token_auth()</code> and specify either the <code class="highlighter-rouge">token_str</code> or the <code class="highlighter-rouge">token_file</code> argument.</p>
<ul>
  <li>The <code class="highlighter-rouge">token_str</code> should be the token text.</li>
  <li>The <code class="highlighter-rouge">token_file</code> is the path to a file containing the token.</li>
</ul>

<p><strong>Example:</strong> Enabling token authentication</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">enable_token_auth</span><span class="p">(</span><span class="n">token_str</span><span class="o">=</span><span class="s">'super-secret-token-string'</span><span class="p">)</span>
<span class="c"># OR</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">enable_token_auth</span><span class="p">(</span><span class="n">token_file</span><span class="o">=</span><span class="s">'/path/to/super/secret'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="enabling-kerberos">Enabling Kerberos</h3>

<p>To enable Kerberos, call <code class="highlighter-rouge">enable_kerberos()</code> and specify the service principal name.
This assumes you have already run <code class="highlighter-rouge">kinit</code> locally.
The caller must specify the service name (first segment of principal) then optionally specify the hostname.</p>

<p><strong>Example:</strong> Connecting to a server with Kerberos principal <code class="highlighter-rouge">okera/service@OKERA.COM</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">enable_kerberos</span><span class="p">(</span><span class="s">'okera'</span><span class="p">,</span> <span class="n">host_override</span><span class="o">=</span><span class="s">'service'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="metadata-apis">Metadata APIs</h2>

<ul>
  <li>
    <p><strong>connect()</strong>
 Creates a connection to ODAS. Callers should call <code class="highlighter-rouge">close()</code> when done or use the <code class="highlighter-rouge">with</code> scoped cleanup.
 To create a connection, call <code class="highlighter-rouge">connect()</code> on the context object.</p>

    <p><strong>Arguments</strong></p>
    <ul>
      <li><code class="highlighter-rouge">host</code> – Hostname of the planner.</li>
      <li><code class="highlighter-rouge">port</code> – The port at which the planner is listening.</li>
    </ul>
  </li>
  <li>
    <p><strong>list_databases()</strong>
 This function takes no arguments and returns all the user-accessible databases.</p>
  </li>
  <li>
    <p><strong>list_dataset_names(db)</strong>
 This function returns the names of all the datasets in a database.
 A database name must be specified.</p>

    <p>The query in the following example collects the names:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
 <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
 <span class="c"># Configure auth if necessary</span>
 <span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
     <span class="n">all_datasets</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">list_databases</span><span class="p">():</span>
         <span class="n">all_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">list_dataset_names</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
     <span class="k">print</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>plan()</strong>
 This is a low level API to plan a scan request.
 <strong>Arguments:</strong>
 <code class="highlighter-rouge">request</code> (str) – Fully qualified dataset name or SQL statement to scan.
 Note that if SQL is specified, it is subject to the same SQL restrictions that ODAS supports.</p>

    <p>The result of this API is typically sent to the worker and contains an internally serialized binary payload.
 The result does contain useful low level information:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
 <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
 <span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">plan</span><span class="p">(</span><span class="s">'okera_sample.users'</span><span class="p">)</span>
     <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
     <span class="c"># Warnings that were generated while planning</span>
     <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">tasks</span><span class="p">))</span>
     <span class="c"># Total number of worker tasks that will need to run</span>
     <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">cols</span><span class="p">))</span>
     <span class="c"># Number of columns in result schema</span>
</code></pre></div>    </div>
    <p>It is also possible to pass a supported SQL request.</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">plan</span><span class="p">(</span><span class="s">'select mask_ccn(ccn) from okera_sample.users'</span><span class="p">)</span>
     <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>execute_ddl(sql)</strong>
 This API takes a single string argument that is the SQL string.
 The supported SQL is the same as any direct ODAS API call.
 The result set is a table, returned as a list of lists of strings (row major).</p>

    <p>As an example, to list the roles and format the output using prettytable (<code class="highlighter-rouge">pip3 install prettytable</code>):</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
 <span class="kn">from</span> <span class="nn">prettytable</span> <span class="kn">import</span> <span class="n">PrettyTable</span>
 <span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
 <span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
     <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute_ddl</span><span class="p">(</span><span class="s">'show roles'</span><span class="p">)</span>
     <span class="n">t</span> <span class="o">=</span> <span class="n">PrettyTable</span><span class="p">()</span>
     <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
         <span class="n">t</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
     <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="scanning-data">Scanning data</h2>

<p>PyOkera supports two scan APIs: <code class="highlighter-rouge">scan_as_pandas()</code> and <code class="highlighter-rouge">scan_as_json()</code>.
They behave identically, except in the result structure.
The <code class="highlighter-rouge">scan_as_pandas()</code> API returns the result as a pandas DataFrame.
The <code class="highlighter-rouge">scan_as_json()</code> API returns the result as a list of JSON objects.</p>

<p>When there is a need to perform further processing, use the faster <code class="highlighter-rouge">scan_as_pandas()</code> API.</p>

<p>Both APIs take as arguments:</p>

<ul>
  <li><code class="highlighter-rouge">request</code> (str) – Fully qualified dataset name or SQL statement to scan.</li>
  <li><code class="highlighter-rouge">max_records</code> (int) – Optional: Maximum number of records to return. Default is unlimited.</li>
</ul>

<p><strong>Example:</strong> Scanning the <code class="highlighter-rouge">okera_sample.sample</code> dataset as JSON</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scan_as_json</span><span class="p">(</span><span class="s">'okera_sample.sample'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Example:</strong> Returning the first 10000 records as a pandas DataFrame from the user’s ccn number</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">okera</span> <span class="kn">import</span> <span class="n">context</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">context</span><span class="p">()</span>
<span class="k">with</span> <span class="n">ctx</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12050</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scan_as_pandas</span><span class="p">(</span><span class="s">'SELECT ccn from okera_sample.users'</span><span class="p">,</span> <span class="n">max_records</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2018 Okera, Inc. All rights reserved.  Site last generated: Nov 5, 2018
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
