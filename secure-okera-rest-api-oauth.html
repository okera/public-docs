<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Secure Okera REST API Access using OAuth | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing Okera</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Overview</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="awsguide">AWS Guide</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="secure-okera-rest-api-oauth">OAuth Authentication</a></li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="standalone-jdbc-cluster">Standalone JDBC Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="third-party-integration">Integration Overview</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">REST API Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">AWS EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">Cloudera CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="databricks-integration">Databricks Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Hadoop Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Hive and Spark Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="aws-cloudtrail-integration">AWS CloudTrail Integration Quick Start</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization-abac">Attribute-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="workspace-page">Workspace</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="data-registration">Data Registration</a> </li>
          
          
          
          
          
          
          <li><a href="managing-tags">Managing Tags</a> </li>
          
          
          
          
          
          
          <li><a href="autotagging-configuration">Configuring Auto-tagging</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Tutorials</a>
      <ul>
          
          
          
          <li><a href="onboarding-datasets">Onboarding datasets</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="secure-okera-rest-api-access-using-oauth">Secure Okera REST API Access using OAuth</h1>
<p>The Okera REST API supports OAuth integration, primarily to enable easier Web UI
access. This document explains how to set up the REST API with OAuth to make the Web UI
login easier.</p>

<h2 id="oauth-basics">OAuth Basics</h2>

<p>In setting up the REST API with basic OAuth integration, the REST API will be able to
accept an OAuth code token and exchange it for an Okera token automatically. This
allows the Web UI to redirect an Okera user from the Okera Login Page to a
preconfigured OAuth service provider (e.g. Google, Ping, etc.), enabling the user to
login from the external OAuth service. Once logged in, the Web UI uses the ODAS REST
API to exchange the resulting OAuth token for an Okera token to gain access to the
Okera Web UI. The user can also then copy his or her token to use it for any Okera
integration point.</p>

<h2 id="prerequisites-to-enable-oauth">Prerequisites to enable OAuth</h2>

<p>You will need the following pieces of information about your OAuth service provider:</p>

<ul>
  <li><strong>Client ID</strong>
This is the OAuth client ID that the service provider requires for authenticating
against Okera. OAuth service providers allow you to create new clients; as part of
this, you will obtain a Client ID.</li>
  <li><strong>Authentication URI</strong>
This is the URI that the OAuth service requires the user to be redirected to when
requesting authentication. Typically, it renders an HTML login page for that service
provider. Once the user has successfully interacted with this page, the user is
redirect back to Okera with an ephemeral <code class="highlighter-rouge">access code</code>.</li>
  <li><strong>Token URI</strong>
This is the URI that Okera must use to exchange the <code class="highlighter-rouge">access code</code> for a service
provider <code class="highlighter-rouge">token</code>. This exchange happens in the REST API.</li>
  <li><strong>Client Secret</strong>
This value is provided by the OAuth service provider as part of setting up a new
client. It is required for Okera to establish trust when attempting the token
exchange.</li>
  <li><strong>Redirect URIs</strong>
This is a list of URIs that will be recognized as acceptable URIs to navigate to
once the Authentication URI flow is over. These need to be configured in the OAuth
service provider in the client configuration. Typically, this is just one URI: the
location of the Okera Web UI’s login page, e.g. <code class="highlighter-rouge">https://my-okera-host:8083/login</code>.
Note: the hostname of the URL should be static, either a static IP or static hostname
value. The Okera Portal is assumed to have a single, static URL for a given cluster.</li>
  <li><strong>Origin URIs</strong>
These URIs are the same as the Redirect URIs, without the <code class="highlighter-rouge">/login</code> part. For example
<code class="highlighter-rouge">https://my-okera-host:8083</code>. These values also need to be configured in the OAuth
service provider, so it will allow redirects from the Okera Web UI.
Note: the hostname of the URL should be static, either a static IP or static hostname
value. The Okera Portal is assumed to have a single, static URL for a given cluster.</li>
  <li><strong>OAuth Scopes (Optional)</strong>
The scopes determine which information the OAuth service provider will allow the user
to access once the token is obtained. Okera needs only very basic information, namely
the subject (<code class="highlighter-rouge">sub</code>) in order to generate an Okera token. Typically, the default here
(<code class="highlighter-rouge">openid profile email</code>). If there are other scopes required by your OAuth service
provider to obtain the <code class="highlighter-rouge">sub</code>, you will need to set them.</li>
  <li><strong>Subject Endpoint (Optional)</strong>
In some deployments, there may be a need to not encode the subject (<code class="highlighter-rouge">sub</code>) in the JWT
response from the OAuth token exchange. In this case, Okera needs to know the
endpoint to call to retrieve the subject, which is the unique user ID that Okera
can use to generate the token. This endpoint is expected to return a JSON response
with <code class="highlighter-rouge">sub</code> being a key on the top-level JSON object, e.g. <code class="highlighter-rouge">{"sub": "abc123", ...}</code>.</li>
</ul>

<h3 id="setting-up-oauth-configurations">Setting up OAuth configurations</h3>

<h4 id="client_secretsjson">client_secrets.json</h4>

<p>Once you have the above information, you will need to create a JSON file with this
information encoded in it. The JSON file has the following form:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"web"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Client</span><span class="w"> </span><span class="err">ID&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s2">"auth_uri"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Authentication</span><span class="w"> </span><span class="err">URI&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_uri"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Token</span><span class="w"> </span><span class="err">URI&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_secret"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Client</span><span class="w"> </span><span class="err">Secret&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s2">"redirect_uris"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Redirect</span><span class="w"> </span><span class="err">URIs&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">],</span><span class="w">
    </span><span class="s2">"javascript_origins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;Your</span><span class="w"> </span><span class="err">Origin</span><span class="w"> </span><span class="err">URIs&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">],</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>For example, if Google OAuth were to be used, after setting up a new Google OAuth
project, we might have the following file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"web"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"example12345.apps.googleusercontent.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"auth_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://accounts.google.com/o/oauth2/auth"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://accounts.google.com/o/oauth2/token"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"client_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"very-secret"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"redirect_uris"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"https://ec2-1234.compute.amazonaws.com:8083/login"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"javascript_origins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"https://ec2-1234.compute.amazonaws.com:8083"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Save this file to <code class="highlighter-rouge">/etc/okera/client_secrets.json</code> on the same machine that the
deployment manager runs. As part of cluster startup, this file will be copied to the
Okera REST Server container.</p>

<blockquote>
  <p><strong>Note</strong> <code class="highlighter-rouge">/etc/okera/client_secrets.json</code> must be configured and present before
the cluster is started up from the Deployment Manager. If a value in this file
needs to be changed, you will need to create a new cluster with the updated
<code class="highlighter-rouge">client_secrets.json</code> file. If this is not possible, please reach out to Okera Support
for guidance.</p>
</blockquote>

<h4 id="environment-variables">Environment variables</h4>

<p>Okera looks for certain environment variables to be set in order to enable OAuth. In
your <code class="highlighter-rouge">/etc/okera/env.sh</code> file, set the following environment variables:</p>
<ul>
  <li><strong>OKERA_OAUTH_SECRETS</strong>, to <code class="highlighter-rouge">/etc/okera/client_secrets.json</code>, or wherever the
 <code class="highlighter-rouge">client_secrets.json</code> file is located. Setting this environment variable enables
 Okera OAuth.</li>
  <li><strong>OKERA_OAUTH_SCOPES</strong> (optional). Space-separated list of scopes required to
 obtain the <code class="highlighter-rouge">sub</code>. This is typically OK to leave unset, in which case the default is
 <code class="highlighter-rouge">"openid profile email"</code>.</li>
</ul>

<p>As an example, the OAuth part of your <code class="highlighter-rouge">env.sh</code> might look like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">OKERA_OAUTH_SECRETS</span><span class="o">=</span><span class="s2">"/etc/okera/client_secrets.json"</span>
<span class="nb">export </span><span class="nv">OKERA_OAUTH_SCOPES</span><span class="o">=</span><span class="s2">"openid profile"</span>
</code></pre></div></div>

<h3 id="verify-oauth">Verify OAuth</h3>

<p>Once you’ve deployed Okera with OAuth enabled, verify that it’s working properly.</p>

<ul>
  <li>
    <p><strong>Check the OAuth connection using CURL</strong>:
The following curl command should return the authentication URI (with client secrets as
params) in the <code class="highlighter-rouge">oauth_url</code> section:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl &lt;ODAS REST Server Host:Port&gt;/api/info
<span class="o">{</span>
  ...,
  <span class="s2">"oauth_url"</span>: <span class="s2">"&lt;your authentication URI plus client secrets params&gt;"</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>For example:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  <span class="s2">"oauth_url"</span>: <span class="s2">"https://accounts.google.com/o/oauth2/auth?scope=openid+profile+email&amp;redirect_uri=.../login&amp;response_type=code&amp;client_id=abc123.apps.googleusercontent.com&amp;access_type=offline"</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="use-the-web-ui">Use the Web UI</h3>

<p>Navigate to the Okera Web UI and there should be a new login option on the login page:
“Login with OAuth”. Upon clicking it, the UI should redirect to your OAuth service
provider’s login screen. Upon successful login, the UI should redirect back to the
Okera Web UI and log you in.</p>

<h3 id="faq">FAQ</h3>

<h4 id="do-the-redirect_uris-and-javascript_origins-need-to-be-accessible-by-my-oauth-identity-provider">Do the <code class="highlighter-rouge">redirect_uris</code> and <code class="highlighter-rouge">javascript_origins</code> need to be accessible by my OAuth Identity Provider?</h4>
<p>No. OAuth Identity Providers do a simple string match against the referrer URI to determine authorization.
For example, if Azure is your IdP, you can still use an internal IP address, internal hostname, or even <code class="highlighter-rouge">localhost</code> as a host for the Okera Portal, as long as the OAuth app in Azure is configured with that hostname.</p>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>If you encounter issues, look in the logs of the ODAS REST Server container, which will
typically contain information about what went wrong.</p>

<ul>
  <li>Verify the JSON validity of <code class="highlighter-rouge">client_secrets.json</code>. If it is not
well-formed, the ODAS REST Server cannot read it.</li>
  <li>Ensure Okera information is probably configured in the OAuth service
provider, e.g. Okera’s Web UI host:port is configured as a valid redirect URI, the
scopes are valid, etc.</li>
  <li>Be sure that the <code class="highlighter-rouge">redirect_uris</code> and <code class="highlighter-rouge">javascript_origins</code> are static so the cluster
does not first need to be created in order for these values to be known. A static DNS hostname that can be pointed to the cluster IP once it is the recommend approach. Note: <code class="highlighter-rouge">localhost</code> works for dev environments.</li>
</ul>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2019 Okera, Inc. All rights reserved.  Site last generated: Aug 29, 2019
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
