<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Cluster Launch Plugin API | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="theme/js/customscripts.js"></script>

<script>
$( document ).ready(function() {
  $( "blockquote:contains('Note')" ).addClass( "admonitionblock note" );
  $( "blockquote:contains('Warning')" ).addClass( "admonitionblock warning" );
  $( "blockquote:contains('Tip')" ).addClass( "admonitionblock tip" );
  $( ".admonitionblock.note" ).prepend( '<i class="fa fa-check admonition"></i>' );
  $( ".admonitionblock.warning" ).prepend( '<i class="fa fa-exclamation-triangle admonition"></i>' );
  $( ".admonitionblock.tip" ).prepend( '<i class="fa fa-lightbulb-o admonition"></i>' );
});
</script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>


</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="navbar-wordmark"><a href="/">
              <img src="assets/images/okera-wordmark-white.png" alt="Okera wordmark" /></a>
            </div>

        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                <!-- entries without drop-downs appear here -->







                <li><a href="search">Search</a></li>



                <li><a href="https://www.okera.com/blog/" target="_blank">Okera Blog</a></li>



                <li><a href="https://okera.com" target="_blank">okera.com</a></li>



                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->


                <!-- comment out this block if you want to hide search
                <li class="dropdown">

                  <div id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>

                </li>
                end search -->
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">


            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">



<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>



  <li>
      <a href="#">Discover</a>
      <ul>



          <li><a href="product-overview">Product Overview</a> </li>






          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>






          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>






          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Install</a>
      <ul>



          <li><a href="getting-started">Getting Started</a> </li>






          <li><a href="install">Installation Guide</a> </li>






          <li><a href="advanced-install">Advanced Installation Option</a> </li>






          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>






          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>






          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>






          <li><a href="cluster-types">Cluster Types</a> </li>






          <li><a href="cluster-sizing">Cluster Sizing</a> </li>






          <li><a href="memory-usage">Platform Memory Usage</a> </li>






          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Engage</a>
      <ul>



          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Administer</a>
      <ul>



          <li><a href="cluster-administration">Cluster Administration</a> </li>






          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>






          <li><a href="schema-design">Schema Design</a> </li>






          <li><a href="authorization">Authorization</a> </li>






          <li><a href="auditing">Auditing</a> </li>






          <li><a href="okera-database-cli">Database CLI</a> </li>






          <li><a href="ip-address-management">IP Address Management</a> </li>






          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>






          <li class="active"><a href="cluster-launch-plugin-api">Cluster Launch API</a></li>




      </ul>
   </li>



  <li>
      <a href="#">Integrate</a>
      <ul>



          <li><a href="emr-integration">EMR Integration</a> </li>






          <li><a href="pycerebro">Native Python Integration</a> </li>






          <li><a href="client-integration">Client Integration</a> </li>






          <li><a href="planner-integration">Planner Integration</a> </li>






          <li><a href="odas-cdh-integration">CDH Integration</a> </li>






          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>






          <li><a href="service-port-assignments">Service Ports</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Develop</a>
      <ul>



          <li><a href="supported-sql">Supported SQL</a> </li>






          <li><a href="odas-authentication">Authentication</a> </li>






          <li><a href="catalog-rest-api">REST API</a> </li>






          <li><a href="client-configs">Client Configuration</a> </li>






          <li><a href="complex-types">Complex Data Types</a> </li>






          <li><a href="data-types">Supported Data Types</a> </li>






          <li><a href="extending-odas">Extending ODAS</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Reference</a>
      <ul>



          <li><a href="release-notes">Release Notes</a> </li>






          <li><a href="quick-recipes">Quick Recipes</a> </li>






          <li><a href="faq">Frequently Asked Questions</a> </li>




      </ul>
   </li>



      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->

    <li>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    </li>


</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>



        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">


<div class="post-content">








  <h1 id="cluster-launch-plugin-api">Cluster Launch Plugin API</h1>

<p>The <strong>Deployment Manager</strong> provides a plugin API to customize how nodes are launched.
The steps are split into two categories.
<strong>Launch scripts</strong> run on the Deployment Manager to launch nodes, while <strong>init scripts</strong> run on the launched nodes.</p>

<p>This topic describes the detailed API for each kind of script.</p>

<h2 id="general">General</h2>

<p>The scripts need to be available to the Deployment Manager.
They can either be files on a shared FileSystem (including S3) or available on the Deployment Manager host.
The Deployment Manager will make a copy of the scripts so subsequent edits do not affect existing uses.</p>

<p>The scripts can be written in any language and we do not inspect them.
We simply run them.
We recommend writing them in Bash, as it will run without requiring bootstrapping (for example, installing Python).</p>

<p>The scripts should return 0 on success and non-zero on error.
The scripts should print to stderr for diagnostics (ignored by Okera except for logging) and print the result to stdout.
Okera parses the output from standard out and it must be output exactly as described in this document.</p>

<p>Either a launch script or a cluster launch script are required to create an environment.</p>

<h2 id="launch-script">Launch script</h2>

<p>This script is responsible for creating one EC2 instance when called.
Examples of actions in this script are:</p>

<ul>
  <li>Launch the EC2 instance in the desired VPC, with SSH keys and the correct security group.</li>
  <li>Tag the instance as required.</li>
</ul>

<p>This script must accept a single argument, which is passed as the <code class="highlighter-rouge">--user-data</code> option when launching the instance in AWS.</p>

<p>The script must also support the <code class="highlighter-rouge">--dryrun</code> flag.
The Deployment Manager (DM) will invoke the launch script with this flag when executing an <code class="highlighter-rouge">environments create</code> command.
When the launch script is called with the <code class="highlighter-rouge">--dryrun</code> flag specified, the DM expects the launch script to exit with a return code of zero (indicating success), regardless of whether the script does anything when the <code class="highlighter-rouge">--dryrun</code> flag is passed (that is, it can be a no-op).
This functionality (the DM calling the script with <code class="highlighter-rouge">--dryrun</code>) is an opportunity to instrument your script to pass the parameters that it would use to AWS in combination with the <code class="highlighter-rouge">--dry-run</code> flag in order to detect configuration or permissions issues early in the install process.
The launch script must not actually launch compute instances when called with the <code class="highlighter-rouge">--dryrun</code> flag.</p>

<p>This script should print <code class="highlighter-rouge">&lt;instance_id&gt;,&lt;public ip&gt;,&lt;private ip&gt;</code> to stdout.
If the host lacks a public IP, then the output would be <code class="highlighter-rouge">&lt;instance id&gt;,,&lt;private ip&gt;</code>.
It <em>cannot</em> output anything else to stdout.</p>

<h3 id="template">Template</h3>

<p>We recommend looking at the template file that comes as part of the Okera install, by default found at <code class="highlighter-rouge">/opt/okera/deploymentmanager/bin/start-ec2-machine-example.sh</code>.
This script can help you get started.
The sections in it marked by <code class="highlighter-rouge">USER</code> are the most common customizations.</p>

<h2 id="cluster-launch-script">Cluster Launch script</h2>

<p>The cluster launch script must create an AWS autoscaling group (ASG) when invoked.
This script must support the following flags:</p>
<ul>
  <li><code class="highlighter-rouge">--host &lt;# of hosts&gt;</code> specifies how many hosts the ASG should contain at any point</li>
  <li><code class="highlighter-rouge">--name &lt;ASG name&gt;</code> the name of the ASG</li>
</ul>

<p>NOTE: the cluster launch script does not currently support the <code class="highlighter-rouge">--dryrun</code> flag because the
underlying AWS call does not support that functionality.</p>

<p>Examples of actions in this script are:</p>

<ul>
  <li>Create a launch configuration with the desired IAM role and security groups specified.</li>
  <li>Launch an autoscaling group in the desired VPC, using the aforementioned launch
configuration.</li>
  <li>Tagging the autoscaling group with the specification that the tags be applied to
EC2 instances created by the autoscaling group.</li>
</ul>

<p>This script should print out a list of n lines to stdout with each containing
<code class="highlighter-rouge">&lt;instance id&gt;,&lt;public ip&gt;,&lt;private ip&gt;</code> where n is the value passed with the
<code class="highlighter-rouge">--host</code> flag. If the ASG lacks a public IP, then the output
would be <code class="highlighter-rouge">&lt;instance id&gt;,,&lt;private ip&gt;</code>.
It <em>cannot</em> output anything else to stdout.</p>

<h3 id="template-1">Template</h3>

<p>We recommend looking at the template file that comes as part of the Okera install, by default found at <code class="highlighter-rouge">/opt/okera/deploymentmanager/bin/start-ec2-asg-example.sh</code>.
This script can help you get started.
The sections in it marked by <code class="highlighter-rouge">USER</code> are the most common customizations.</p>

<h2 id="init-scripts">Init scripts</h2>

<p>The Deployment Manager allows you to specify a list of scripts that should be run on the instance when it is first provisioned.
This is equivalent to running all of these scripts as part of the <code class="highlighter-rouge">--user-data</code> AWS EC2 configuration.</p>

<p>These scripts are run in the order provided, always before any Okera instance setup scripts.
Weâ€™ve included an example that will set up the package repo to an internal location:
<code class="highlighter-rouge">/opt/okera/deploymentmanager/bin/setup-repo-example.sh</code>.</p>

<p>Init scripts should return non-zero on error and can log to stdout or stderr.</p>


    <div class="tags">

    </div>




</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                  <img src="assets/images/icon-footer.png" class="logo" />
                  <div class="footer-meta">
               &copy;2018 Okera, Inc. All rights reserved. <br />
 Site last generated: May 18, 2018
                  </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
