<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Cluster Administration | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="theme/js/customscripts.js"></script>

<script>
$( document ).ready(function() {
  $( "blockquote:contains('Note')" ).addClass( "admonitionblock note" );
  $( "blockquote:contains('Warning')" ).addClass( "admonitionblock warning" );
  $( "blockquote:contains('Tip')" ).addClass( "admonitionblock tip" );
  $( ".admonitionblock.note" ).prepend( '<i class="fa fa-check admonition"></i>' );
  $( ".admonitionblock.warning" ).prepend( '<i class="fa fa-exclamation-triangle admonition"></i>' );
  $( ".admonitionblock.tip" ).prepend( '<i class="fa fa-lightbulb-o admonition"></i>' );
});
</script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>


</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="navbar-wordmark"><a href="/">
              <img src="assets/images/okera-wordmark-white.png" alt="Okera wordmark" /></a>
            </div>

        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                <!-- entries without drop-downs appear here -->







                <li><a href="search">Search</a></li>



                <li><a href="https://www.okera.com/blog/" target="_blank">Okera Blog</a></li>



                <li><a href="https://okera.com" target="_blank">okera.com</a></li>



                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->


                <!-- comment out this block if you want to hide search
                <li class="dropdown">

                  <div id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>

                </li>
                end search -->
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">


            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">



<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>



  <li>
      <a href="#">Discover</a>
      <ul>



          <li><a href="product-overview">Product Overview</a> </li>






          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>






          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>






          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Install</a>
      <ul>



          <li><a href="getting-started">Getting Started</a> </li>






          <li><a href="install">Installation Guide</a> </li>






          <li><a href="advanced-install">Advanced Installation Option</a> </li>






          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>






          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>






          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>






          <li><a href="cluster-types">Cluster Types</a> </li>






          <li><a href="cluster-sizing">Cluster Sizing</a> </li>






          <li><a href="memory-usage">Platform Memory Usage</a> </li>






          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Engage</a>
      <ul>



          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Administer</a>
      <ul>



          <li class="active"><a href="cluster-administration">Cluster Administration</a></li>






          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>






          <li><a href="schema-design">Schema Design</a> </li>






          <li><a href="authorization">Authorization</a> </li>






          <li><a href="auditing">Auditing</a> </li>






          <li><a href="okera-database-cli">Database CLI</a> </li>






          <li><a href="ip-address-management">IP Address Management</a> </li>






          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>






          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Integrate</a>
      <ul>



          <li><a href="emr-integration">EMR Integration</a> </li>






          <li><a href="pycerebro">Native Python Integration</a> </li>






          <li><a href="client-integration">Client Integration</a> </li>






          <li><a href="planner-integration">Planner Integration</a> </li>






          <li><a href="odas-cdh-integration">CDH Integration</a> </li>






          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>






          <li><a href="service-port-assignments">Service Ports</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Develop</a>
      <ul>



          <li><a href="supported-sql">Supported SQL</a> </li>






          <li><a href="odas-authentication">Authentication</a> </li>






          <li><a href="catalog-rest-api">REST API</a> </li>






          <li><a href="client-configs">Client Configuration</a> </li>






          <li><a href="complex-types">Complex Data Types</a> </li>






          <li><a href="data-types">Supported Data Types</a> </li>






          <li><a href="extending-odas">Extending ODAS</a> </li>




      </ul>
   </li>



  <li>
      <a href="#">Reference</a>
      <ul>



          <li><a href="release-notes">Release Notes</a> </li>






          <li><a href="quick-recipes">Quick Recipes</a> </li>






          <li><a href="faq">Frequently Asked Questions</a> </li>




      </ul>
   </li>



      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->

    <li>

<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    </li>


</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>



        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">


<div class="post-content">








  <h1 id="cluster-administration">Cluster Administration</h1>

<p>This document describes how to use the CLI for administering running clusters.
Refer to the <a href="install">Installation</a> document for details on how to create new clusters.</p>

<blockquote>
  <p><strong>Note:</strong> A single Deployment Manager can administer multiple ODAS clusters.</p>
</blockquote>

<h2 id="prerequisites">Prerequisites</h2>

<p>The utility <code class="highlighter-rouge">ocadm</code> must be installed and configured to the Deployment Manager.
You can ensure connectivity by using:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm status
</code></pre></div></div>

<h2 id="scaling-an-existing-cluster">Scaling an Existing Cluster</h2>

<p>An existing cluster can be scaled to a new size.
Scaling is performed from the CLI using the update command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters update <span class="nt">--numNodes</span><span class="o">=</span>&lt;desired size&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<p><strong>Example:</strong> Scaling cluster 1’s number of nodes to 20:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters update <span class="nt">--numNodes</span><span class="o">=</span>20 1
</code></pre></div></div>

<p>This command is used to scale a cluster up or down in size.
Okera manages the underlying machines life cycle by launching new ones, and terminating scaled down ones, as required.</p>

<blockquote>
  <p><strong>Note:</strong> The cluster must have been created using either the <code class="highlighter-rouge">--launchScript</code> or
<code class="highlighter-rouge">--clusterLaunchScript</code> options.</p>
</blockquote>

<h2 id="setting-the-number-of-planners">Setting the Number of Planners</h2>

<p>Okera, by default, picks the number of planners to run.
The optimal number of planners depends on the environment and workload. For users who desire to fine tune the cluster, the number of planners is controlled using the <code class="highlighter-rouge">clusters update</code> command.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters update <span class="nt">--numPlanners</span><span class="o">=</span>&lt;number&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>
The planner number cannot exceed the cluster size.
It requires restarting the cluster for the change to take effect.</p>
</blockquote>

<h2 id="enabling-termination-protection">Enabling Termination Protection</h2>

<p>Clusters can be configured to use EC2’s termination protection feature.
When enabled, termination protection prevents the cluster from being scaled or terminated without first disabling it.
This disabling and enabling cycle prevents the accidental misconfiguration of a running cluster.</p>

<p>To enable or disable terminal protection:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters update <span class="se">\</span>
 <span class="nt">--terminationProtectionEnabled</span><span class="o">=</span>&lt;<span class="nb">true</span>|false&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<p><strong>Example:</strong> Enabling termination protection for cluster 5</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters update <span class="nt">--terminationProtectionEnabled</span><span class="o">=</span><span class="nb">true </span>5
</code></pre></div></div>

<h2 id="upgrading-an-existing-cluster">Upgrading an Existing Cluster</h2>

<p>An existing cluster can be upgraded with a new version of ODAS components.
The CLI command is used to upgrade one or more components.
After upgrading the cluster, it is restarted with the upgraded components.</p>

<blockquote>
  <p><strong>Note:</strong> Both version and components options cannot be specified at the same time.</p>
</blockquote>

<p>To upgrade all components in an existing cluster to a new version, specify version only.
To upgrade specific cluster components to a different version, specify components only.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters upgrade <span class="se">\</span>
 <span class="nt">--components</span><span class="o">=</span>&lt;components_version_list&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters upgrade <span class="se">\</span>
 <span class="nt">--version</span> &lt;upgrade_version&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<p><strong>Note:</strong> Specified components take the form of <code class="highlighter-rouge">component:version</code>.</p>

<p><strong>Example:</strong> Upgrading cluster 2’s ODAS components to version 1.0.0 and web UI to 1.0.1:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters upgrade <span class="nt">--components</span><span class="o">=</span>cdas:1.0.0,web-ui:1.0.1 2
</code></pre></div></div>

<p><strong>Example:</strong> Upgrading all ODAS components in cluster 3 to version 0.4.5.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters upgrade <span class="nt">--version</span><span class="o">=</span>0.4.5 3
</code></pre></div></div>

<h3 id="setting-a-new-cluster-version">Setting a New Cluster Version</h3>

<p>To configure Deployment Manager so that new clusters use upgraded version of ODAS components, use the <code class="highlighter-rouge">set_default_version</code> command.
Exceptions can be assigned with the <code class="highlighter-rouge">--components</code> option.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters set_default_version <span class="se">\</span>
 <span class="nt">--version</span><span class="o">=</span>&lt;upgrade_version&gt; <span class="se">\</span>
 <span class="nt">--components</span><span class="o">=</span>&lt;components_version_list&gt; &lt;cluster_id&gt;
</code></pre></div></div>

<p><strong>Example:</strong> Setting new clusters to 1.0.0, with the planner and workers at 1.0.1</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters set_default_version <span class="nt">--version</span><span class="o">=</span>1.0.0 <span class="nt">--components</span><span class="o">=</span>cdas:1.0.1
</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong> The <code class="highlighter-rouge">--components</code> option is required. It may be specified as an empty string(“”).</p>
</blockquote>

<h2 id="checking-cluster-status">Checking Cluster Status</h2>

<p>Use the <code class="highlighter-rouge">list</code> command to query the status of all clusters controlled by Deployment Manager.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocadm clusters list
</code></pre></div></div>

<p><strong>Example:</strong> Cluster list command results</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>description      id  name       numNodes  numRunningServices    owner    statusCode    statusMessage                                                                           <span class="nb">type</span>
<span class="nt">-------------</span>  <span class="nt">----</span>  <span class="nt">-------</span>  <span class="nt">----------</span>  <span class="nt">--------------------</span>  <span class="nt">-------</span>  <span class="nt">------------</span>  <span class="nt">--------------------------------------------------------------------------------------</span>  <span class="nt">------------------</span>
                137  cluster1          1  7/7                   admin    READY         All services running.                                                                   STANDALONE_CLUSTER
</code></pre></div></div>

<p>The <code class="highlighter-rouge">numRunningServices</code> value indicates which services are currently passing their health checks.
The services are always enumerated in a fixed order, enabling an administrator to understand which services are up and healthy.</p>

<p>The set of services running on a given cluster depends on the cluster’s configuration.
Refer to the <a href="cluster-types">Cluster Types</a> document for the listing that applies to your given setup.</p>

<p>As an example, consider the situation where a standalone cluster had an issue with the planner configuration where the planner could not start up.
In that scenario, the number of running services would be listed as <code class="highlighter-rouge">3/7</code>.
The first three services (canary, zookeeper, and catalog) would all pass health checking successfully.
The fourth service (planner) would not pass a health check successfully.</p>

<p>The state of services 5, 6 and 7 are not known in that situation.
Services with higher numbers depend on a subset of the services with lower numbers.
Lower-numbered services having issues preclude a higher-numbered service from correctly providing its full range of functionality.</p>

<p>A service successfully passing its health check does not preclude it from returning an error on a given request.
Rather, it indicates that the service was able to startup successfully, including passing all initial service configuration validations.
The service responded to the most recent Deployment Manager request to its health check endpoint.</p>

<h2 id="cluster-diagnosis">Cluster diagnosis</h2>

<p>It may occassionally be helpful to gather system logs from the nodes in a cluster when
a functional issue or performance issue occurs. A cluster can be commanded to compile
a gzipped tar-ball of all system logs over the previous day and upload the archive to
a cluster’s S3 logging bucket with a simple command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ocadm clusters diag 137
</code></pre></div></div>

<p>This produces the following output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  A tar-gzip file containing cluster logs will be uploaded to the following path shortly:
  s3://contoso-logging-bucket/diagnostics/2018-04-06-21-03-15-614/cluster1/bb717d32-253e-4617-a504-5bec14ace6f7/okera_diag_1_1.tgz
</code></pre></div></div>

<p>Additionally, the cluster can be commanded to compile logs for a specified number of days
in the past and upload the tarball to a preferred S3 URI path with a specific file name:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ocadm clusters diag <span class="nt">--days</span> 3 <span class="nt">--file</span> analytics_hiccup.tar.gz <span class="nt">--s3-upload-path</span> s3://contoso-private/analytics-team 137
</code></pre></div></div>

<p>This produces the following output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  A tar-gzip file containing cluster logs will be uploaded to the following path shortly:
  s3://contoso-private/analytics-team/diagnostics/2018-04-06-21-48-18-769/cluster1/2fe5d94d-9b0d-4dac-b3b9-6a721dc3fe98/analytics_hiccup.tar.gz
</code></pre></div></div>

<p>In the example above, the cluster with id ‘137’ was commanded to package system logs that
were written within the previous 3 days and to upload the resulting tarball to a specific
S3 path with a specific filename.</p>

<h2 id="synchronizing-roles-and-permissions-between-catalogsentry-and-planner-nodes">Synchronizing Roles and Permissions between Catalog/Sentry and Planner nodes</h2>

<p>The Planner refreshes its roles from the Catalog every 60 seconds.
Any changes made directly to the Sentry database in the Catalog might take up to a minute to reflect in the Planner nodes.</p>

<p>Planner nodes cache the role and permissions information from the Catalog.
When multiple Planner nodes are present in a ODAS cluster, a policy is followed of eventual consistency for maintaining cache coherence.
This policy could be fine tuned in the future if needed.</p>


    <div class="tags">

    </div>




</div>



<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                  <img src="assets/images/icon-footer.png" class="logo" />
                  <div class="footer-meta">
               &copy;2018 Okera, Inc. All rights reserved. <br />
 Site last generated: May 18, 2018
                  </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
