<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title> | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing Okera</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Overview</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="awsguide">AWS Guide</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="standalone-jdbc-cluster">Standalone JDBC Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="third-party-integration">Integration Overview</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">REST API Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">AWS EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">Cloudera CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="databricks-integration">Databricks Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Hadoop Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Hive and Spark Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="aws-cloudtrail-integration">AWS CloudTrail Integration Quick Start</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization-abac">Attribute-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="workspace-page">Workspace</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="data-registration">Data Registration</a> </li>
          
          
          
          
          
          
          <li><a href="managing-tags">Managing Tags</a> </li>
          
          
          
          
          
          
          <li><a href="autotagging-configuration">Configuring Auto-Tagger</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Tutorials</a>
      <ul>
          
          
          
          <li><a href="onboarding-datasets">Onboarding datasets</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <!-- TOC depthFrom:2 depthTo:4 withLinks:1 updateOnSave:1 orderedList:0 -->

<h1 id="3-okera-install---setting-up-an-odas-cluster">3. Okera Install - Setting up an ODAS Cluster</h1>

<ul>
  <li><a href="#downloading-and-installing-a-cluster">Downloading the package</a></li>
  <li><a href="#create-a-cluster">Create a Cluster</a></li>
  <li><a href="#update-to-a-quickstart-cluster">Update a Cluster</a></li>
  <li><a href="#configure-a-cluster">Update a Cluster</a></li>
  <li><a href="#expand-a-cluster">Expand a Cluster</a></li>
  <li><a href="#shrink-a-cluster">Shrink a Cluster</a></li>
  <li><a href="#okctl-and-gravity">CLI tools</a></li>
</ul>

<!-- /TOC -->

<h1 id="odas">ODAS</h1>

<p>With this package, you have everything you need in order to install ODAS on your machine in a self-contained way.</p>

<p>This document assumes the prerequisites are complete.</p>

<h2 id="downloading-and-installing-a-cluster">Downloading and installing a cluster</h2>

<p>Download and run the install script.
This will download the ODAS package and install it in the current directory.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nv">$ </span>curl https://s3.amazonaws.com/okera-release-useast/1.4.0-gravity/gravity/install.sh | sh -
</code></pre></div></div>

<p>This will do a preflight check for the node and then output a command that can be run to start up the cluster.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ...
  2019/05/06 07:04:39 If you are creating a new cluster, you can execute:
  2019/05/06 07:04:39
  2019/05/06 07:04:39   <span class="nb">cd</span> /home/ec2-user/okera-1.4.0-gravity <span class="o">&amp;&amp;</span> <span class="nb">sudo</span> ./gravity install <span class="nt">--token</span><span class="o">=</span>mlRbdtDSfO <span class="nt">--advertise-addr</span><span class="o">=</span>10.1.10.58 <span class="nt">--cloud-provider</span><span class="o">=</span>generic <span class="nt">--config</span><span class="o">=</span>cluster-config.yaml <span class="nt">--pod-network-cidr</span><span class="o">=</span><span class="s2">"172.23.0.0/16"</span> <span class="nt">--service-cidr</span><span class="o">=</span><span class="s2">"172.34.0.0/16"</span>
  2019/05/06 07:04:39
  2019/05/06 07:04:39 If you later want to join a new node to this cluster, you can execute the following on that node:
  2019/05/06 07:04:39
  2019/05/06 07:04:39   <span class="nb">sudo</span> ./gravity join <span class="nt">--token</span><span class="o">=</span>mlRbdtDSfO <span class="nt">--role</span><span class="o">=</span>worker 10.1.10.58 <span class="nt">--cloud-provider</span><span class="o">=</span>generic
  2019/05/06 07:04:39
  2019/05/06 07:04:39 You can reference <span class="s1">'join.cmd'</span> and <span class="s1">'join.asg.cmd'</span> <span class="k">for </span>future use

  <span class="c"># Run the command from above. In this example:</span>
  <span class="nv">$ </span><span class="nb">cd</span> /home/ec2-user/okera-1.4.0-gravity <span class="o">&amp;&amp;</span> <span class="nb">sudo</span> ./gravity install <span class="nt">--token</span><span class="o">=</span>mlRbdtDSfO <span class="nt">--advertise-addr</span><span class="o">=</span>10.1.10.58 <span class="nt">--cloud-provider</span><span class="o">=</span>generic <span class="nt">--config</span><span class="o">=</span>cluster-config.yaml <span class="nt">--pod-network-cidr</span><span class="o">=</span><span class="s2">"172.23.0.0/16"</span> <span class="nt">--service-cidr</span><span class="o">=</span><span class="s2">"172.34.0.0/16"</span>
</code></pre></div></div>

<p>Creating the cluster the first time is expected to take between 5-10 minutes.
When the kubernetes cluster is set up, the terminal will output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Mon May  6 07:12:12 UTC	Installation succeeded <span class="k">in </span>6m49.121813725s

  Cluster endpoints:
      <span class="k">*</span> Authentication gateway:
          - 10.1.10.58:32009
      <span class="k">*</span> Cluster management URL:
          - https://10.1.10.58:32009

  Application endpoints:
      <span class="k">*</span> odas:1.4.0-gravity:
          - ODAS UI:
              - http://10.1.10.58:8083
          - ODAS Planner:
              - tcp://10.1.10.58:12050
          - ODAS Worker:
              - tcp://10.1.10.58:13050
          - ODAS REST:
              - http://10.1.10.58:8089

  Congratulations!
  The cluster is up and running. Please take a look at <span class="s2">"cluster management"</span> section:
  https://gravitational.com/gravity/docs/cluster/
</code></pre></div></div>

<p>From there, the ODAS services will be installed and take an additional 5 minutes to start up.
You can monitor it by watching the kubernetes pods until they are all running.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>watch kubectl get pods
  Every 2.0s: kubectl get pods                                                                                                Mon May  6 07:14:53 2019

  NAME                                  READY   STATUS    RESTARTS   AGE
  canary-vpj92                          1/1     Running   0          3m
  cdas-rest-server-85df454b77-8rvkk     1/1     Running   0          2m59s
  cerebro-catalog-85c94d6c4c-7gp9g      1/1     Running   0          3m
  cerebro-planner-5b47b876cc-w6qch      1/1     Running   0          2m59s
  cerebro-web-df49588d5-4dszh           1/1     Running   0          2m59s
  cerebro-worker-pf8hl                  1/1     Running   0          2m59s
  presto-coordinator-76667d4444-fjqmd   1/1     Running   0          2m59s
  presto-worker-vgp2r                   1/1     Running   0          2m59s
  zookeeper-0                           1/1     Running   0          3m

  <span class="c"># When complete, you can verify by running:</span>
  <span class="nv">$ </span>curl http://0.0.0.0:8089/api/info
  <span class="o">{</span><span class="s2">"oauth_url"</span>: null, <span class="s2">"is_oauth_enabled"</span>: <span class="nb">false</span>, <span class="s2">"is_kerberos_enabled"</span>: <span class="nb">false</span>, <span class="s2">"is_jwt_enabled"</span>: <span class="nb">false</span>, <span class="s2">"planner_endpoint"</span>: <span class="s2">"10.1.10.58:12050"</span>, <span class="s2">"is_sso_enabled"</span>: <span class="nb">false</span>, <span class="s2">"build_hash"</span>: <span class="s2">"391ae5408cc4537972ca0da724de41e79e491c04"</span>, <span class="s2">"is_ldap_enabled"</span>: <span class="nb">false</span>, <span class="s2">"planner_version"</span>: <span class="s2">"1.4.0-gravity"</span>, <span class="s2">"ad_login_enabled"</span>: <span class="nb">false</span>, <span class="s2">"image_version"</span>: <span class="s2">"1.4.0-gravity"</span><span class="o">}</span>
</code></pre></div></div>

<p>Once they are all running, you can navigate to your machine’s IP/DNS at port <code class="highlighter-rouge">8083</code> to log into the UI.
The default token of the cluster is <code class="highlighter-rouge">root</code>.</p>

<h2 id="update-to-a-quickstart-cluster">Update to a Quickstart Cluster</h2>

<p>The package ships with <code class="highlighter-rouge">okctl</code>, a simple command line utility to help you create new clusters, validate configuration and update configuration.</p>

<p>We’ll first use <code class="highlighter-rouge">okctl</code> to convert the current cluster into a <code class="highlighter-rouge">quickstart cluster</code>, which is representative of recommended authentication settings suited for functional evaluation.</p>

<p>Specifically, the cluster will be configured to:</p>
<ul>
  <li>Enable Json Web Token (JWT) and multi-user authentication</li>
  <li>Enable SSL</li>
  <li>TODO: now’s your chance to change the ports</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># From the install directory</span>
  <span class="nv">$ </span>./okctl update <span class="nt">--config</span> configs/config-quickstart.yaml
</code></pre></div></div>

<p>This will reconfigure and restart the cluster.
You can monitor the progress by running <code class="highlighter-rouge">kubectl get pods</code>, which may be convinient to run with <code class="highlighter-rouge">watch</code> until they are all <code class="highlighter-rouge">Running</code>.</p>

<h3 id="user-management">User management</h3>

<p>This configures the cluster to allow user/password login.
By default, this will create an <code class="highlighter-rouge">okera/okera</code> admin user.
Additional users can be created using <code class="highlighter-rouge">okctl</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># This creates a testuser/secret user account</span>
  <span class="nv">$ </span>./okctl users create testuser testuser-secret
</code></pre></div></div>

<p>Navigate to the WebUI and you should be able to login with both the <code class="highlighter-rouge">okera</code> and <code class="highlighter-rouge">testuser</code> accounts.</p>

<p><strong>Note</strong> Adding users via <code class="highlighter-rouge">okctl</code> is not for production use, where Active Directory(AD) with your enterprise AD is recommended. This is only suited for development and testing as a quick way to get started.</p>

<p>At this point, the cluster is ready and configured to support multiple users.</p>

<p>Depending on the goals of this cluster, the next steps could be any of the below, which can all happen independently.</p>

<ul>
  <li>Continue to configure the cluster to be closer to a production install and integrate with your existing services, for example Active Directory.</li>
  <li>Register datasets, create roles and policies</li>
  <li>Connect the catalog to your existing Hive Metastore</li>
  <li>Access data from ODAS from compute tools (e.g. Elastic MapReduce, Python notebooks)</li>
</ul>

<h2 id="configure-a-cluster">Configure a Cluster</h2>

<p>You can continue to configure the running cluster using <code class="highlighter-rouge">okctl</code>
You can see an example config file in <code class="highlighter-rouge">configs/config.example.yaml</code>, which looks like:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ports</span><span class="pi">:</span>
  <span class="c1"># Ports that must be exposed for clients connecting to ODAS.</span>
  <span class="na">UI</span><span class="pi">:</span> <span class="s">8083</span>
  <span class="na">REST</span><span class="pi">:</span> <span class="s">8089</span>
  <span class="na">PLANNER_API</span><span class="pi">:</span> <span class="s">12050</span>
  <span class="na">WORKER_API</span><span class="pi">:</span> <span class="s">13050</span>
  <span class="na">PRESTO_API</span><span class="pi">:</span> <span class="s">14050</span>

<span class="na">cluster</span><span class="pi">:</span>
  <span class="c1">#</span>
  <span class="c1"># These are configurations for the kubernetes cluster. The CIDR blocks are</span>
  <span class="c1"># used exclusively within the kubernetes cluster for internal communication.</span>
  <span class="c1"># The CIDR blocks should *not* overlap with CIDR blocks currently being used,</span>
  <span class="c1"># including the VPC. For example, these changes should *not* be within the</span>
  <span class="c1"># VPC range.</span>
  <span class="c1">#</span>
  <span class="na">portRange</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1025-65535"</span>
  <span class="na">podCidr</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.23.0.0/16"</span>
  <span class="na">serviceCidr</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.34.0.0/16"</span>

<span class="na">config</span><span class="pi">:</span>
  <span class="c1">#</span>
  <span class="c1"># Configurations for deploying an ODAS cluster. Dummy values are set as</span>
  <span class="c1"># examples and should be replaced.</span>
  <span class="c1"># For configs marked [Optional], simplify comment that section out.</span>
  <span class="c1">#</span>

  <span class="c1">#</span>
  <span class="c1"># General system wide configs.</span>
  <span class="c1">#</span>
  <span class="na">OKERA_CLUSTER_NAME</span><span class="pi">:</span> <span class="s">dev-cluster-1.4.1</span>
  <span class="na">OKERA_CLUSTER_LABEL</span><span class="pi">:</span> <span class="s">dev</span>
  <span class="na">TZ</span><span class="pi">:</span> <span class="s2">"</span><span class="s">America/New_York"</span>

  <span class="c1">#</span>
  <span class="c1"># Logging and auditing directories.</span>
  <span class="c1">#</span>
  <span class="na">WATCHER_AUDIT_LOG_DST_DIR</span><span class="pi">:</span> <span class="s">s3://company/okera/logs</span>
  <span class="na">WATCHER_LOG_DST_DIR</span><span class="pi">:</span> <span class="s">s3://company/okera/audit</span>
  <span class="na">WATCHER_S3_REGION</span><span class="pi">:</span> <span class="s">us-east-1</span>
  <span class="na">WATCHER_S3_ENCRYPT</span><span class="pi">:</span> <span class="no">true</span>

  <span class="c1">#</span>
  <span class="c1"># Users and groups (comma-separated) that have admin privileges on the catalog</span>
  <span class="c1">#</span>
  <span class="na">CATALOG_ADMINS</span><span class="pi">:</span> <span class="s">admin</span>

  <span class="c1">#</span>
  <span class="c1"># MySQL database url and connection credentials.</span>
  <span class="c1">#</span>
  <span class="na">CATALOG_DB_ENGINE</span><span class="pi">:</span> <span class="s">mysql</span>
  <span class="na">CATALOG_DB_URL</span><span class="pi">:</span> <span class="s">aurora.xyz.us-east-1.rds.amazon.com:3306</span>
  <span class="na">CATALOG_DB_USER</span><span class="pi">:</span> <span class="s">dbusername</span>
  <span class="na">CATALOG_DB_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>

  <span class="c1">#</span>
  <span class="c1"># Names of databases within the database instance where ODAS stores metadata. ODAS</span>
  <span class="c1"># will need read and write access to these databases and they must all be unique.</span>
  <span class="c1">#</span>
  <span class="na">CATALOG_DB_HMS_DB</span><span class="pi">:</span> <span class="s">odas_hms</span>
  <span class="na">CATALOG_DB_SENTRY_DB</span><span class="pi">:</span> <span class="s">odas_sentry</span>
  <span class="na">CATALOG_DB_USERS_DB</span><span class="pi">:</span> <span class="s">odas_users</span>

  <span class="c1">#</span>
  <span class="c1"># [Optional] Configuration to enable JWT authentication</span>
  <span class="c1">#</span>
  <span class="na">JWT_ALGORITHM</span><span class="pi">:</span> <span class="s">RSA512</span>
  <span class="na">JWT_PUBLIC_KEY</span><span class="pi">:</span> <span class="s">s3://company/okera/conf/id_rsa.512.pub</span>
  <span class="na">SYSTEM_TOKEN</span><span class="pi">:</span> <span class="s">s3://company/okera/conf/okera.token</span>

  <span class="c1">#</span>
  <span class="c1"># [Optional] LDAP configuration</span>
  <span class="c1">#</span>
  <span class="na">LDAP_HOST</span><span class="pi">:</span> <span class="s">ldap.company.com</span>
  <span class="na">LDAP_PORT</span><span class="pi">:</span> <span class="s">636</span>
  <span class="na">LDAP_BIND_TEMPLATE</span><span class="pi">:</span> <span class="s">cn=%s,ou=users,dc=company,dc=com</span>
</code></pre></div></div>

<p>We will focus on the <code class="highlighter-rouge">config</code> section above, which you can change with your own configuration.
Note that you do not have to set all of these (delete or comment out the ones you do not need), and this can be done iteratively.</p>

<p>Once you have have updated these (say by creating a new file called <code class="highlighter-rouge">prod-config.yaml</code>), you can validate that your configurations are correct:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./okctl --config=prod-config.yaml validate
2019/04/28 21:21:51 [validate:diskspace] passed
2019/04/28 21:21:51 [validate:mysql] passed
2019/04/28 21:21:51 [validate:ldap] passed
2019/04/28 21:21:52 [validate:s3-read/OKERA_AUTOTAGGER_CONFIGURATION/json] passed
2019/04/28 21:21:52 [validate:s3-read/JWT_PUBLIC_KEY/pubkey] passed
2019/04/28 21:21:52 [validate:s3-read/SYSTEM_TOKEN/token] passed
2019/04/28 21:21:52 [validate:s3-write/WATCHER_S3_REGION/WATCHER_LOG_DST_DIR] passed
2019/04/28 21:21:52 [validate:s3-write/WATCHER_S3_REGION/WATCHER_AUDIT_LOG_DST_DIR] passed
2019/04/28 21:21:52 [validate:local-dns] passed
</code></pre></div></div>

<p>You can then update the running cluster:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./okctl --config=prod-config.yaml update
2019/04/28 21:22:35 [validate:diskspace] passed
2019/04/28 21:22:35 [validate:mysql] passed
2019/04/28 21:22:35 [validate:ldap] passed
2019/04/28 21:22:35 [validate:s3-read/OKERA_AUTOTAGGER_CONFIGURATION/json] passed
2019/04/28 21:22:35 [validate:s3-read/JWT_PUBLIC_KEY/pubkey] passed
2019/04/28 21:22:36 [validate:s3-read/SYSTEM_TOKEN/token] passed
2019/04/28 21:22:36 [validate:s3-write/WATCHER_S3_REGION/WATCHER_LOG_DST_DIR] passed
2019/04/28 21:22:36 [validate:s3-write/WATCHER_S3_REGION/WATCHER_AUDIT_LOG_DST_DIR] passed
2019/04/28 21:22:36 [validate:local-dns] passed
2019/04/28 21:22:36 Updated config hash: 589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7
2019/04/28 21:22:37 Updated Canary deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated Zookeeper deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated Catalog deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated Cerebro deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated Worker deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated REST Server deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated UI deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
2019/04/28 21:22:37 Updated Presto deployment to config '589d94287e392f43d8616084f7125810579e78b5196ee918135e4a34fabb66c7'
</code></pre></div></div>

<p>This will restart the existing cluster with the updated configuration.</p>

<h2 id="expand-a-cluster">Expand a Cluster</h2>

<p>If you have more machines to add to the existing cluster, you can copy this package (you can either get all of <code class="highlighter-rouge">odas.tar</code> or just the <code class="highlighter-rouge">gravity</code> binary) to that machine.
You will then use the <code class="highlighter-rouge">join</code> command that was output when you ran <code class="highlighter-rouge">okctl prepare</code> earlier, which you was saved to a file called <code class="highlighter-rouge">join.cmd</code> (on the machine where you initially created the cluster).</p>

<p>You can execute it like this (where <code class="highlighter-rouge">10.1.10.68</code> is the address of the original node):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./gravity join --token=VvYfYHGzku --role=worker 10.1.10.68
Sun Apr 28 21:30:22 UTC	Connecting to cluster
Sun Apr 28 21:30:23 UTC	Connected to existing cluster at 10.1.10.68
Sun Apr 28 21:30:24 UTC	Operation has been created
Sun Apr 28 21:30:25 UTC	Configure packages for the joining node
Sun Apr 28 21:30:26 UTC	Bootstrap the joining node
Sun Apr 28 21:30:27 UTC	Pull packages on the joining node
Sun Apr 28 21:31:28 UTC	Install system package teleport:3.0.5
Sun Apr 28 21:31:29 UTC	Install system package odas-planet:1.4.0-gravity
Sun Apr 28 21:31:47 UTC	Wait for the planet to start
Sun Apr 28 21:32:27 UTC	Operation has completed
Sun Apr 28 21:32:27 UTC	Joined cluster in 2m4.103961218s
</code></pre></div></div>

<p>Once this is complete you will have a two-node cluster (or N-node, if you keep going).</p>

<h2 id="shrink-a-cluster">Shrink a Cluster</h2>

<p>If you would like to remove a node from the cluster, on that you node you can just execute:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./gravity leave
Please confirm removing ip-10-1-10-124 (10.1.10.124) from the cluster (yes/no):
yes
launched operation "2b9bbed5-f306-4462-a0bc-8e5b77bdca97", use 'gravity status' to poll its progress
</code></pre></div></div>

<p>Note that if this is the only node in the cluster, you will need to add the <code class="highlighter-rouge">--force</code> flag, as this will delete the cluster permanently.</p>

<h2 id="okctl-and-gravity">okctl and gravity</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ okctl --help
usage: okctl [&lt;flags&gt;] &lt;command&gt; [&lt;args&gt; ...]

the ODAS Controller.

Flags:
      --help           Show context-sensitive help (also try --help-long and --help-man).
  -c, --config=CONFIG  Config file to use

Commands:
  help [&lt;command&gt;...]
    Show help.

  validate
    Validate that all set configurations are valid and functional.

  update [&lt;flags&gt;]
    Update configuration of a running cluster.

  prepare [&lt;flags&gt;]
    Prepare configurations to create a new a cluster.
</code></pre></div></div>

<p>Additionally, this package contains a tool called <code class="highlighter-rouge">gravity</code> to help create entirely self-contained Kubernetes deployments that include ODAS</p>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2019 Okera, Inc. All rights reserved.  Site last generated: Jun 4, 2019
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
