<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Auditing | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing the Deployment Manager</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installing the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="okera-prereq">Okera Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="okera-installation-setting-up-deployment-manager">Setting Up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="okera-installation-setting-up-odas-cluster">Setting Up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="auditing">Auditing</a></li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="complex-types">Complex Data Types</a> </li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="catalog-rest-api">REST API</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Client Configuration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="third-party-integration">Third-Party Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="auditing">Auditing</h1>

<h2 id="introduction">Introduction</h2>

<p>A vital part of data governance is the ability to quickly and coherently respond to security threats.
This is also critical for regulatory purposes and compliancy requests.
Enterprises are often required to use company-wide <em>security information and event management</em> (SIEM) software that allows the correlation of audit log events generated by IT systems.
For any data provided by the Okera Platform, there is a single audit log location with text files that contain JSON formated records for each monitored action.
This includes all access to data and metadata, such as the Schema Registry to retrieve dataset information.</p>

<p>Every access to the Okera Platform services is authenticated by the respective endpoint, and the access operation is written to the audit logs in great detail, containing not only the user making the request, but also the API that is used, if the request was successful, and so on.
All requests eventually flow through the ODAS Planner(s) and Workers, irrespective of the API used.
The Planner is used, among other things, to retrieve dataset definitions and plan the distribution of the query across all available cluster nodes.
These requests are authenticated and authorized by the Planner, which then appends an audit event record to its local log.
The Workers are responsible to serve the dataset rows as needed by the clients, applying any filtering or masking on the fly.
Before any data is returned the client request is again authenticated, creating an audit event entry to be appended to the Worker’s local log.
After serving data and upon concluding the client request, the Worker(s) also log the amount of data that was transmitted to and from the client, with which you can determine the usage for individuals and groups, and develop, for instance, charge-back models.</p>

<h2 id="audit-logs">Audit Logs</h2>

<p>The Planners, Workers, gateway servers, and so on are configured to upload their local log to a central storage location, usually the configured installation directory.
For AWS, this is a directory in an S3 bucket the servers have write access to.
The location is configured with the <code class="highlighter-rouge">OKERA_STAGING_DIR</code> environment variable set in the <code class="highlighter-rouge">env.sh</code> and before starting the Deployment Manager process.
If you want to change this environment variable, you would need to update the <code class="highlighter-rouge">env.sh</code> file and restart the Deployment Manager.</p>

<blockquote>
  <p><strong>Note:</strong> Changing this setting only applies to cluster that are started thereafter.
For an existing cluster a restart would be necessary to set the new log location.</p>
</blockquote>

<p>For example, here is what the content of a staging directory may look like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ aws s3 ls s3://acme-ops/prod-7/
        PRE audit/
        PRE canary/
        PRE cdas_rest_server/
        PRE cerebro_catalog/
        PRE cerebro_planner/
        PRE cerebro_web/
        PRE cerebro_worker/
        PRE clusters/
        PRE zookeeper/
...
</code></pre></div></div>

<p>The first directory shown, named <code class="highlighter-rouge">audit</code>, is the one containing the uploaded audit logs from all cluster nodes.
For performance reasons the data is partitioned by day inside the audit directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ aws s3 ls s3://acme-ops/prod-7/audit/
        PRE ymd=2018-09-05/
        PRE ymd=2018-09-06/
        PRE ymd=2018-09-07/
        PRE ymd=2018-09-08/
        PRE ymd=2018-09-09/
        PRE ymd=2018-09-10/
</code></pre></div></div>

<p>Looking into a particular partition directory reveals the already uploaded logs, here one from a Planner and another from a Worker instance:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ aws s3 ls s3://acme-ops/prod-7/audit/ymd=2018-09-05/
2018-09-06 08:18:06     814762 \
  planner-10.1.10.181-0-731c5cf0-4917-4947-b199-7fb257efcfba_audit.log
2018-09-10 15:25:00     143733 \
  worker-10.1.10.181-0-3e80936e-30d0-4080-a519-f1676d6544bf_audit.log
</code></pre></div></div>

<p>The file name is comprises the service name, the internal IP address of the node hosting it, a squence number, and a UUID, making the log unique for a specific instance of a service.</p>

<blockquote>
  <p><strong>Note:</strong> There is usually no need to know about those files and where they exactly came from.
Using the provided audit table and views (see below) will handle the files implicitly when executing queries on top of them.</p>
</blockquote>

<p>You can use the <a href="reports-page">Reports Page</a> in the Okera Portal to easily explore and analyze these audit logs.
Here an example of the raw JSON record that is appended to the audit log for every client access:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ "request_time":"2018-09-05 16:19:01.628368000",
  "request_id":"97451917614274a8:bd6c2b3347c651a6",
  "start_unix_time":1536164341628,
  "end_unix_time":1536164342121,
  "auth_failure":false,
  "status":"ok",
  "user":"root",
  "connected_user":"root",
  "client_network_address":"::1:52774",
  "client_application":"okera-execute-ddl",
  "num_results_returned":0,
  "statement_type":"DDL",
  "default_db":"default",
  "statement":"CREATE ROLE IF NOT EXISTS okera_public_role",
  "ae_database":"","ae_function":"",
  "ae_role":"okera_public_role",
  "ae_table":"","ae_view":""}
</code></pre></div></div>

<h3 id="other-logs">Other Logs</h3>

<p>Planner(s) and Workers generate additional log files that contain <em>all</em> of the log events these processes generate, including the audit logs events.
They are located in another top-level directory in the staging location, one per service type (see <a href="cluster-types">Cluster Types</a> for a list of services depending on the selected cluster type), and can be used by administrators for debugging purposes.
For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ aws s3 ls s3://acme-ops/prod-7/cerebro_planner/
2018-09-05 18:19:05     108632 2018-09-05-16-19-04-planner- \
  10.1.10.181-0-07a6e2e5-2014-4f1d-8abc-14a04618b341.log
2018-09-05 18:19:21      48361 2018-09-05-16-19-20-planner- \
  10.1.10.181-1-7df31dc6-43bd-4265-aa54-f11f5d7b22a8.log
2018-09-05 18:19:37        591 2018-09-05-16-19-36-planner- \
  10.1.10.181-2-62e16fed-b2ba-4ce6-936a-c0911c37636a.log

$ aws s3 ls s3://acme-ops/prod-7/cerebro_web/                                                                    130 ↵
2018-09-05 18:20:21        405 2018-09-05-16-20-19-web- \
  10.1.10.181-0-57950e12-360e-4629-bc89-763b567ad123.log
2018-09-05 18:27:33         76 2018-09-05-16-27-32-web- \
  10.1.10.181-1-acd846c6-6b32-4af7-99d0-880b9b0e3a46.log
2018-09-05 18:52:39         76 2018-09-05-16-52-38-web- \
  10.1.10.181-2-d41ad909-e46f-4b4d-b4a3-95a3ede57aa5.log

$ aws s3 ls s3://acme-ops/prod-7/cdas_rest_server/
2018-09-05 18:20:05      13763 2018-09-05-16-20-04-cdas-rest-server- \
  10.1.10.181-0-ec031b3f-e971-4c38-adb4-01a6d9a28c42.log
2018-09-05 18:20:21        532 2018-09-05-16-20-20-cdas-rest-server- \
  10.1.10.181-1-1102aab4-8571-4d53-bffe-f51fe3084765.log
2018-09-05 18:20:37        364 2018-09-05-16-20-36-cdas-rest-server- \
  10.1.10.181-2-f512e3e5-80b9-42b5-97d0-26e9d8c8259f.log
</code></pre></div></div>

<p>The audit log records are prefixed in the mixed service logs with <code class="highlighter-rouge">Audit.log</code>, on a single line.
For example, a service log with technical and audit log entries may look like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stderr: I0905 16:19:02.174656   228 impala-server.cc:1162] \
  RegisterQuery(): query_id=bb4986e8cab0d521:823bc5dbc662b3b4
stderr: I0905 16:19:02.266245   228 impala-server.cc:1212] \
  UnregisterQuery(): query_id=bb4986e8cab0d521:823bc5dbc662b3b4
stderr: I0905 16:19:02.267323   228 impala-server.cc:679] Audit.log: \
  {"request_time":"2018-09-05 16:19:02.173889000","request_id": \
  "ec4264da5511c330:a38cf5108c8b9b85","start_unix_time":1536164342173, \
  "end_unix_time":1536164342267,"auth_failure":false,"status":"ok", \
  "user":"root","connected_user":"root","client_network_address": \
  "::1:52776","client_application":"okera-execute-ddl", \
  "num_results_returned":0,"statement_type":"DDL","default_db":"default", \
  "statement":"GRANT ROLE okera_public_role TO GROUP __okera_public_group", \
  "ae_database":"","ae_function":"","ae_role":"","ae_table":"","ae_view":""}
stdout: Connecting to planner localhost:12050
</code></pre></div></div>

<h2 id="audit-log-format">Audit Log Format</h2>

<p>Each audit log is a JSON record with the schema shown below.
By default, the full audit log data is made available within the special <code class="highlighter-rouge">okera_system</code> database, as a table named <code class="highlighter-rouge">audit_logs</code>.</p>

<blockquote>
  <p><strong>Note:</strong> The fields in the audit log schema are considered stable and will not be removed in future releases.
It is expected that more fields are added in the future.</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ymd</td>
      <td>STRING</td>
      <td>The table partitioning string, derived from the request_time in the form of <code class="highlighter-rouge">YYYY-MM-DD</code>.</td>
    </tr>
    <tr>
      <td>request_time</td>
      <td>STRING</td>
      <td>Human-formatted GMT time when the request started.</td>
    </tr>
    <tr>
      <td>request_id</td>
      <td>STRING</td>
      <td>Unique ID for this request.</td>
    </tr>
    <tr>
      <td>start_unix_time</td>
      <td>BIGINT</td>
      <td>Unix epoch time at which the request completed (or failed).</td>
    </tr>
    <tr>
      <td>end_unix_time</td>
      <td>BIGINT</td>
      <td>Unix epoch time at which the audit entry was generated.</td>
    </tr>
    <tr>
      <td>auth_failure</td>
      <td>BOOLEAN</td>
      <td>Set to true if the request failed due to authorization or authentication failure.</td>
    </tr>
    <tr>
      <td>status</td>
      <td>STRING</td>
      <td>Status message of the request. “ok” if the request succeeded; error details otherwise.</td>
    </tr>
    <tr>
      <td>user</td>
      <td>STRING</td>
      <td>The effective user running the request. This is the user whose access permissions are used to validate the request.</td>
    </tr>
    <tr>
      <td>connected_user</td>
      <td>STRING</td>
      <td>The user that is authenticated at the network connection level. This can be different from ‘user’ if the ‘connected_user’ is running on behalf of another user.</td>
    </tr>
    <tr>
      <td>client_application</td>
      <td>STRING</td>
      <td>The client application, including client version, that originated the request. Examples: execute-ddl, presto (1.0.0)</td>
    </tr>
    <tr>
      <td>client_network_address</td>
      <td>STRING</td>
      <td>The client host and port.</td>
    </tr>
    <tr>
      <td>statement_type</td>
      <td>STRING</td>
      <td>The type of the request.</td>
    </tr>
    <tr>
      <td>statement</td>
      <td>STRING</td>
      <td>Log of the request. Depending on the statement type, this will vary in format but captures the request being made.</td>
    </tr>
    <tr>
      <td>num_results_returned</td>
      <td>BIGINT</td>
      <td>The number of records returned by the query.</td>
    </tr>
    <tr>
      <td>ae_database</td>
      <td>STRING</td>
      <td>A list of the databases accessed during the processing of the query.</td>
    </tr>
    <tr>
      <td>ae_table</td>
      <td>STRING</td>
      <td>A list of the tables accessed during the processing of the query.</td>
    </tr>
    <tr>
      <td>ae_view</td>
      <td>STRING</td>
      <td>A list of the views accessed during the processing of the query.</td>
    </tr>
    <tr>
      <td>ae_function</td>
      <td>STRING</td>
      <td>A list of the functions executed during the processing of the query.</td>
    </tr>
    <tr>
      <td>ae_role</td>
      <td>STRING</td>
      <td>A list of the roles modified during the processing of the query.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note:</strong> Only stable fields are documented here.
Others found in the logs are not considered stable and are subject to deprecation or unannounced removal.</p>
</blockquote>

<h2 id="audit-log-views">Audit Log Views</h2>

<p>For convenience, the <code class="highlighter-rouge">okera_system</code> database is also providing special views on top of the raw audit log table.
These views provide implicit filtering based on the partitioning information.</p>

<h3 id="daily-audit-log-view">Daily Audit Log View</h3>

<p>The first view, named <code class="highlighter-rouge">daily_audit_logs</code>, restricts the data to the data of the last partition.
Since the audit table is partitioned by day, this means the view returns the data of the current day.</p>

<blockquote>
  <p><strong>Note:</strong> The audit log views use the ODAS-specific <a href="supported-sql#last-partitionslast-files">LAST PARTITION</a> feature.</p>
</blockquote>

<p>For instance, the daily audit log view is defined like so:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">okera_system</span><span class="p">.</span><span class="n">daily_audit_logs</span>
<span class="k">COMMENT</span> <span class="s1">'Audited logs from the current day.'</span>
<span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">okera_system</span><span class="p">.</span><span class="n">steward_audit_logs</span><span class="p">(</span><span class="k">LAST</span> <span class="n">PARTITION</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="weekly-audit-log-view">Weekly Audit Log View</h3>

<p>The <code class="highlighter-rouge">weekly_audit_logs</code> view is similar to the daily log view, but sets the number of partitions to return to seven, that is, one week.
Using this view gives access to the last seven days, including the current day (which most likely is still accumulating data).</p>

<h3 id="monthly-audit-log-view">Monthly Audit Log View</h3>

<p>The <code class="highlighter-rouge">monthly_audit_logs</code> view is similar to the daily log view, but sets the number of partitions to return to thirty, that is, one month.
Using this view gives access to the last thirty days, including the current day (which most likely is still accumulating data).</p>

<h3 id="steward-audit-log-view">Steward Audit Log View</h3>

<p>A more tailored audit log view is available as <code class="highlighter-rouge">steward_audit_logs</code>.
It only returns audit log rows that refer to objects, that is, database, table, or view name, which the current user has administrative access to.
For example, assuming there is a dataset named <code class="highlighter-rouge">salesdb.transactions</code> and a user <code class="highlighter-rouge">bob</code> that is part of the <code class="highlighter-rouge">sales_steward</code> role, a catalog or database administrator would need to grant the <code class="highlighter-rouge">ALL</code> privilege to the <code class="highlighter-rouge">sales_steward</code> role on the <code class="highlighter-rouge">salesdb.transactions</code> object so that user <code class="highlighter-rouge">bob</code> is able to see the audit log rows that pertain to that dataset.</p>

<h3 id="reporting-audit-log-view">Reporting Audit Log View</h3>

<p>The Okera Portal and its <a href="reports-page">Reports Page</a> use the <code class="highlighter-rouge">reporting_audit_logs</code> view that builds on the steward audit log view to provide access to the most important columns of the audit logs, while applying the same filtering.
In other words, the user running reports will only see audit log records concerning objects they have full access to.
The reporting view also filters out unnecessary audit records that would otherwise cause for the reports to show inaccurate aggregates.
For example, the view filters out ODAS service internal communication, as well as one record for events that have both a start and end entry in the logs.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2018 Okera, Inc. All rights reserved.  Site last generated: Sep 18, 2018
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
