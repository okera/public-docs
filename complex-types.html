<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Complex Data Types | Okera User Documentation</title>
<link rel="stylesheet" href="theme/css/syntax.css">
<link rel="icon" type="image/png" href="/assets/images/icon-favicon32.png">

<script src="https://use.fontawesome.com/d9343c4626.js"></script>

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="theme/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
<!-- Old Algolia Instant Search -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> -->
<!-- End Old Algolia Instant Search -->
<link rel="stylesheet" href="theme/css/asciidoctor.css">
<link rel="stylesheet" href="theme/css/custom.css">
<link rel="stylesheet" href="theme/css/boxshadowproperties.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="theme/js/jquery.navgoco.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="theme/js/toc.js"></script>
<script src="theme/js/customscripts.js"></script>

<!-- Old Algolia Instant Search -->
<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> -->
<!-- End Old Algolia Instant Search -->

<!-- Include AlgoliaSearch JS Client and autocomplete.js library -->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>

<script>
  $(document).ready(function () {
    $("blockquote:contains('Note')").addClass("admonitionblock note");
    $("blockquote:contains('Warning')").addClass("admonitionblock warning");
    $("blockquote:contains('Tip')").addClass("admonitionblock tip");
    $(".admonitionblock.note").prepend('<i class="fa fa-check admonition"></i>');
    $(".admonitionblock.warning").prepend('<i class="fa fa-exclamation-triangle admonition"></i>');
    $(".admonitionblock.tip").prepend('<i class="fa fa-lightbulb-o admonition"></i>');
  });
</script>


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">

        <div class="row">
            <div class="col-sm-4 col-md-3">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-wordmark">
                        <a href="/">
                            <img src="assets/images/okera-wordmark-white.svg" alt="Okera wordmark" />
                        </a>
                    </div>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                    <ul class="nav navbar-nav">
                        <!-- toggle sidebar button -->
                        <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> -->
                        <!-- entries without drop-downs appear here -->

                            
                        <li>
                            <a href="https://okera.com" target="_blank">okera.com</a>
                        </li>
                          
                        <!-- entries with drop-downs appear here -->
                        <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                         
                    </ul>
                </div>
            </div>
            <form class="aa-input-container navbar-form" id="aa-input-container" role="search">
                <div class="form-group">
                    <input id="aa-search-input" type="text" class="aa-input-search form-control" placeholder="Search"
                        autocomplete="off">
                </div>
            </form>
        </div>
        <!-- Algolia Integrated search Script -->
        <script type="text/javascript" src="theme/js/okera-integrated-search.js"></script>
        <!-- comment out this block if you want to hide jekyll search
                  <div class="navbar-form" id="search-demo-container">
                      <form action="/search" method="GET">
                      <input type="text" name="q" id="search-input" placeholder="Search the docs...">
                      </form>
                  </div>
                end search -->
    </div>
</nav>
<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                


<ul id="mysidebar" class="nav affix">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Introduction to Okera</a>
      <ul>
          
          
          
          <li><a href="product-overview">Product Overview</a> </li>
          
          
          
          
          
          
          <li><a href="odas-overview">Okera Data Access Service Overview</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-overview">Okera Catalog Overview</a> </li>
          
          
          
          
          
          
          <li><a href="okera-architecture-overview">Platform Architecture Overview</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Installing Okera</a>
      <ul>
          
          
          
          <li><a href="getting-started">Getting Started</a> </li>
          
          
          
          
          
          
          <li><a href="install">Installation Overview</a> </li>
          
          
          
          
          
          
          <li><a href="install-prereqs">Installation Prerequisites</a> </li>
          
          
          
          
          
          
          <li><a href="install-dm">Setting up the Deployment Manager</a> </li>
          
          
          
          
          
          
          <li><a href="install-odas">Setting up the ODAS Cluster</a> </li>
          
          
          
          
          
          
          <li><a href="advanced-install">Advanced Installation Options</a> </li>
          
          
          
          
          
          
          <li><a href="awsguide">AWS Guide</a> </li>
          
          
          
          
          
          
          <li><a href="odas-authentication">Authentication Guide</a> </li>
          
          
          
          
          
          
          <li><a href="kerberos-cluster-setup">Kerberos</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-ldap">LDAP Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-okera-rest-api-oauth">OAuth Authentication</a> </li>
          
          
          
          
          
          
          <li><a href="secure-deployment-manager-rest-api">Deployment Manager REST Security</a> </li>
          
          
          
          
          
          
          <li><a href="support-versions">Versions</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administering ODAS Clusters</a>
      <ul>
          
          
          
          <li><a href="cluster-administration">Cluster Administration</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-types">Cluster Types</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-sizing">Cluster Sizing</a> </li>
          
          
          
          
          
          
          <li><a href="memory-usage">Platform Memory Usage</a> </li>
          
          
          
          
          
          
          <li><a href="ip-address-management">IP Address Management</a> </li>
          
          
          
          
          
          
          <li><a href="kubernetes-dashboard-quickstart">Cluster Monitoring with Kubernetes Addons</a> </li>
          
          
          
          
          
          
          <li><a href="cluster-launch-plugin-api">Cluster Launch API</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Catalog</a>
      <ul>
          
          
          
          <li><a href="authorization">Role-based Access Control</a> </li>
          
          
          
          
          
          
          <li><a href="privileges">Privileges</a> </li>
          
          
          
          
          
          
          <li><a href="schema-design">Schema Design</a> </li>
          
          
          
          
          
          
          <li><a href="authorization-builtins">Authorization Builtin Functions</a> </li>
          
          
          
          
          
          
          <li><a href="auditing">Auditing</a> </li>
          
          
          
          
          
          
          <li><a href="okera-database-cli">Database CLI</a> </li>
          
          
          
          
          
          
          <li><a href="supported-sql">Supported SQL</a> </li>
          
          
          
          
          
          
          <li><a href="jdbc-data-source">JDBC Data Source</a> </li>
          
          
          
          
          
          
          <li><a href="data-types">Supported Data Types</a> </li>
          
          
          
          
          
          
          <li class="active"><a href="complex-types">Complex Data Types</a></li>
          
          
          
          
          
          
          <li><a href="extending-odas">Extending ODAS</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Using the Web UI</a>
      <ul>
          
          
          
          <li><a href="web-ui-basics">Okera Portal Basics</a> </li>
          
          
          
          
          
          
          <li><a href="datasets-page">Datasets Page</a> </li>
          
          
          
          
          
          
          <li><a href="permissions-page">Permissions Page</a> </li>
          
          
          
          
          
          
          <li><a href="reports-page">Reports Page</a> </li>
          
          
          
          
          
          
          <li><a href="data-registration">Data Registration</a> </li>
          
          
          
          
          
          
          <li><a href="web-ui-admin">Okera Portal for Admins</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Integrating with ODAS</a>
      <ul>
          
          
          
          <li><a href="third-party-integration">Integration Overview</a> </li>
          
          
          
          
          
          
          <li><a href="planner-integration">Planner Integration</a> </li>
          
          
          
          
          
          
          <li><a href="pyokera">Native Python Integration</a> </li>
          
          
          
          
          
          
          <li><a href="catalog-rest-api">REST API Integration</a> </li>
          
          
          
          
          
          
          <li><a href="emr-integration">AWS EMR Integration</a> </li>
          
          
          
          
          
          
          <li><a href="odas-cdh-integration">Cloudera CDH Integration</a> </li>
          
          
          
          
          
          
          <li><a href="databricks-integration">Databricks Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-integration">Hadoop Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="client-configs">Hive and Spark Client Integration</a> </li>
          
          
          
          
          
          
          <li><a href="hive-best-practices">Hive Integration - Best Practices</a> </li>
          
          
          
          
          
          
          <li><a href="tableau-web-data-connector">Tableau Integration</a> </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Reference</a>
      <ul>
          
          
          
          <li><a href="release-notes">Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="earlier-release-notes">Earlier Release Notes</a> </li>
          
          
          
          
          
          
          <li><a href="service-port-assignments">Service Ports</a> </li>
          
          
          
          
          
          
          <li><a href="s3-encryption-support">Supported S3 Encryption Types</a> </li>
          
          
          
          
          
          
          <li><a href="compatibility-guarantees">Compatibility Guarantees</a> </li>
          
          
          
          
          
          
          <li><a href="quick-recipes">Quick Recipes</a> </li>
          
          
          
          
          
          
          <li><a href="https://okera.zendesk.com/hc/en-us/categories/115000493607-FAQs" target="_blank">Frequently Asked Questions</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
        -->
    
    <li>
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2', title: 'On This Page' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 80);
  return false
})

});
</script>

<div id="toc"></div>

    </li>
    

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            

<div class="post-content">

   

    


    

  <h1 id="complex-data-types">Complex Data Types</h1>

<p>This document details the support for complex types in ODAS.</p>

<p>The suppored types include:</p>

<ul>
  <li><a href="#structs">structs</a></li>
  <li><a href="#array">arrays</a></li>
  <li><a href="#map">maps</a> (limited support; see below for details)</li>
  <li><a href="#limited-support-for-unions-in-avro">unions</a> (limited support; see below for details)</li>
</ul>

<p>There is no plan to support unions or enums in ODAS, excepting in special cases for Avro. See details below.</p>

<h2 id="file-format-support">File format support</h2>

<p>Complex type support applies to data stored in Avro and Parquet formats.</p>

<h2 id="structs">Structs</h2>

<p>ODAS supports struct types with up to 100 levels of nesting. Struct types are useful for logs, event data, and other records that use JSON.</p>

<p>Several examples below are based on the following schema below to illustrate how ODAS supports structs.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"uid"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"san francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="using-a-create-ddl-statement-with-avro-formatted-json-data">Using a CREATE DDL statement with Avro-formatted JSON data</h3>

<p>ODAS supports the HiveQL DDL for table creation. To create a table using our example schema (assuming Avro format):</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">users</span><span class="p">(</span>
  <span class="n">uid</span> <span class="n">BIGINT</span><span class="p">,</span>
  <span class="k">user</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">address</span> <span class="n">STRUCT</span><span class="o">&lt;</span>
    <span class="n">city</span><span class="p">:</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="k">state</span><span class="p">:</span> <span class="n">STRING</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">age</span> <span class="n">INT</span>
<span class="p">)</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">AVRO</span>
<span class="k">LOCATION</span> <span class="s1">'s3://okera/rs-complex-users/'</span>
</code></pre></div></div>

<p>A description of this table will return:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">describe</span> <span class="n">users</span><span class="p">;</span>
<span class="n">uid</span>	<span class="n">bigint</span>
<span class="n">name</span>	<span class="n">string</span>
<span class="n">address</span>	<span class="n">struct</span><span class="o">&lt;</span>
  <span class="n">city</span><span class="p">:</span><span class="n">string</span><span class="p">,</span>
  <span class="k">state</span><span class="p">:</span><span class="n">string</span>
<span class="o">&gt;</span>
<span class="n">age</span>	<span class="n">int</span>
</code></pre></div></div>

<h4 id="creating-a-ddl-with-file-based-avro-schema">Creating a DDL with file-based Avro schema</h4>

<p>If a schema is stored in an <code class="highlighter-rouge">.avsc</code> file, the <code class="highlighter-rouge">CREATE</code> statement can use that file in lieu of an explicit schema definition. Given a <code class="highlighter-rouge">users.avsc</code> file, for example, you could write:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">LIKE</span> <span class="n">AVRO</span> <span class="s1">'s3://path/to/schemas/users.avsc'</span>
<span class="k">LOCATION</span> <span class="s1">'s3://okera/rs-complex-users/'</span>
</code></pre></div></div>

<p>This approach offers several advantages:</p>
<ul>
  <li>It is less error-prone than typing or a cut-and-paste operation.</li>
  <li>It is the only option for large, detailed schema, in particular any schema that contains a struct whose serialized values exceed 4kb. Any attempt to paste such a schema into a CREATE statement would fail and report the field is too long.</li>
  <li>If a field name is typed incorrectly in HiveQL, the engine can only infer a new field is being declared, resulting in a schema change instead of an error. Reading from a schema file will avoid this potential confusion.</li>
  <li>Some valid Avro artifacts, such as an empty struct, have no analog in HiveQL. The ODAS engine can however handle these cases transparently when they are read from an Avro schema file.</li>
</ul>

<h5 id="using-a-non-standard-avro-schema-file">Using a non-standard Avro schema file</h5>

<p>ODAS assumes the given Avro path will point to a well-formed <a href="https://avro.apache.org/docs/1.8.1/spec.html#schemas">Avro JSON schema</a>. The ODAS engine can also read an Avro schema that has been embedded in a JSON object.</p>

<p>Say there is an <code class="highlighter-rouge">avro-json.json</code> file that includes the following elements:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">'owner'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">'user'</span><span class="p">,</span><span class="w">
    </span><span class="err">'custom'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">'key'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">'value'</span><span class="p">,</span><span class="w">
        </span><span class="err">'path'</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">avro</span><span class="w"> </span><span class="err">schema</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">escaped</span><span class="w"> </span><span class="err">json</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>You can write a <code class="highlighter-rouge">CREATE TABLE</code> statement to read the <code class="highlighter-rouge">avro-json.json</code> file and extract the Avro schema by setting the <code class="highlighter-rouge">avro.schema.field.path</code> table property as follows:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">example</span>
<span class="k">LIKE</span> <span class="n">AVRO</span> <span class="s1">'s3://data/schemas/avro-json.json'</span>
<span class="n">STORED</span> <span class="k">AS</span> <span class="n">AVRO</span> <span class="k">LOCATION</span> <span class="s1">'s3://data/rs-complex-users/'</span>
<span class="n">TBLPROPERTIES</span><span class="p">(</span><span class="s1">'avro.schema.field.path'</span><span class="o">=</span><span class="s1">'custom.path'</span><span class="p">)</span>
</code></pre></div></div>

<p>ODAS will locate the schema using the JSON identifier <code class="highlighter-rouge">custom.path</code>.</p>

<h3 id="using-create-view-with-complex-type-subfields">Using CREATE VIEW with complex type subfields</h3>

<p>You can create views using just a subfield of a complex type. Column names in a view cannot contain a dot(.), so it’s necessary to give them an alias:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_city</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="n">address</span><span class="p">.</span><span class="n">city</span> <span class="k">AS</span> <span class="n">cityname</span> <span class="k">FROM</span> <span class="n">users</span>
</code></pre></div></div>
<p>Omitting the alias will throw an error:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_city</span> <span class="k">AS</span> <span class="k">Select</span> <span class="k">user</span><span class="p">,</span> <span class="n">address</span><span class="p">.</span><span class="n">city</span> <span class="k">from</span> <span class="n">users</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Could not execute ddl., detail:AnalysisException: Invalid column/field name: address.city</code></p>

<h3 id="scanning-data-with-the-odas-rest-api">Scanning data with the ODAS REST API</h3>

<p>The REST API supports JSON be default. Invoking the curl utility against the <code class="highlighter-rouge">users</code> table endpoint will return:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> curl REST_SERVER:PORT/api/scan/users
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"uid"</span>: 100,
        <span class="s2">"user"</span>: <span class="s2">"alice"</span>,
        <span class="s2">"address"</span>: <span class="o">{</span>
            <span class="s2">"city"</span>: <span class="s2">"san francisco"</span>,
            <span class="s2">"state"</span>: <span class="s2">"ca"</span>
        <span class="o">}</span>,
        <span class="s2">"age"</span>: 25
    <span class="o">}</span>,
    <span class="o">{</span>
        <span class="s2">"uid"</span>: 101,
        <span class="s2">"user"</span>: <span class="s2">"bob"</span>,
        <span class="s2">"address"</span>: <span class="o">{</span>
            <span class="s2">"city"</span>: <span class="s2">"seattle"</span>,
            <span class="s2">"state"</span>: <span class="s2">"wa"</span>
        <span class="o">}</span>,
        <span class="s2">"age"</span>: 25
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong> This example omits the authentication headers for brevity. See (REST API OAuth](catalog-rest-api#authentication) for details.</p>
</blockquote>

<h3 id="scanning-a-table-via-sparksql">Scanning a table via SparkSQL</h3>

<p>ODAS support for struct types aligns with Spark’s record type. Some representative queries on the <code class="highlighter-rouge">users</code> table include:</p>

<ul>
  <li>Creating an ephemeral table:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="n">s</span><span class="s">"""
        |CREATE TEMPORARY TABLE users
        |USING com.cerebro.recordservice.spark.DefaultSource
        |OPTIONS (RecordServiceTable 'users')
   """</span><span class="o">.</span><span class="n">stripMargin</span><span class="o">)</span>
</code></pre></div>    </div>
    <p>Note: in EMR (or any ODAP configuration that uses an external Hive Metastore), you can omit this step and just write queries against <code class="highlighter-rouge">db.table</code>.)</p>
  </li>
  <li>Returning a record count:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT count(*) from users"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</code></pre></div>    </div>
  </li>
  <li>Selecting the first column:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT uid from users"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</code></pre></div>    </div>
    <p>Recall the <em>type</em> of the <code class="highlighter-rouge">uid</code> field is <code class="highlighter-rouge">BIGINT</code>.</p>
  </li>
  <li>Selecting the first column and a subfield of the struct. This request flattens the nested type:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT uid, address.city from users"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</code></pre></div>    </div>
  </li>
  <li>Selecting the first column and the column containing a struct:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT uid, address from users"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</code></pre></div>    </div>
  </li>
  <li>Selecting all fields from the table:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">val</span> <span class="n">row</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT * from users"</span><span class="o">).</span><span class="n">collect</span><span class="o">()(</span><span class="mi">0</span><span class="o">)</span>  <span class="c1">// Row for 'alice'
</span> <span class="n">assert</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="mi">100</span><span class="o">)</span>
 <span class="n">assert</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="s">"alice"</span><span class="o">)</span>
 <span class="n">assert</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="s">"seattle"</span><span class="o">)</span>
 <span class="n">assert</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="s">"wa"</span><span class="o">)</span>
 <span class="n">assert</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">==</span> <span class="mi">25</span><span class="o">)</span>
</code></pre></div>    </div>
    <p>The top-level record consists of four fields <code class="highlighter-rouge">[BIGINT, STRING, STRUCT, INT]</code>.</p>
  </li>
</ul>

<h3 id="scanning-via-apache-hive">Scanning via Apache Hive</h3>

<p>The Avro struct type maps to Hive’s struct type.
For example, describing the <code class="highlighter-rouge">users</code> schema:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   hive&gt; describe users<span class="p">;</span>
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   OK
   uid                 	bigint
   user                	string
   address             	struct&lt;city:string,state:string&gt;
   age                 	int
</code></pre></div></div>

<p>A few more examples of Hive DDL-based scans:</p>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select</span> <span class="k">*</span> from users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"san francisco"</span>,<span class="s2">"state"</span>:<span class="s2">"ca"</span><span class="o">}</span>	25
<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"seattle"</span>,<span class="s2">"state"</span>:<span class="s2">"wa"</span><span class="o">}</span>	25
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select </span>uid, user from users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
100	alice
101	bob
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select </span>uid, address from users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
100	<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"san francisco"</span>,<span class="s2">"state"</span>:<span class="s2">"ca"</span><span class="o">}</span>
101	<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"seattle"</span>,<span class="s2">"state"</span>:<span class="s2">"wa"</span><span class="o">}</span>
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select </span>uid, address.city from users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
100	san francisco
101	seattle
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select</span> <span class="k">*</span> from users where uid <span class="o">=</span> 100<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
100	alice	<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"san francisco"</span>,<span class="s2">"state"</span>:<span class="s2">"ca"</span><span class="o">}</span>	25
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select </span>address.city, count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from users group by address.city<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
seattle	1
san francisco	1
</code></pre></div></div>

<p><em>Query</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hive&gt; <span class="k">select</span> <span class="k">*</span> from users where address.state <span class="o">=</span> <span class="s1">'wa'</span><span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
101	bob	<span class="o">{</span><span class="s2">"city"</span>:<span class="s2">"seattle"</span>,<span class="s2">"state"</span>:<span class="s2">"wa"</span><span class="o">}</span>	25
san francisco	1
</code></pre></div></div>

<h3 id="scanning-table-data-with-presto">Scanning table data with Presto</h3>

<p>Presto supports struct types. The examples below reflect the expected Presto experience.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; describe recordservice.default.users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Column  |               Type               | Extra | Comment
<span class="nt">---------</span>+----------------------------------+-------+---------
 uid     | bigint                           |       |
 user    | varchar                          |       |
 address | row<span class="o">(</span>city varchar, state varchar<span class="o">)</span> |       |
 age     | integer                          |       |
</code></pre></div></div>

<p>Some additional examples:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select</span> <span class="k">*</span> from recordservice.default.users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> uid | user  |            address             | age
<span class="nt">-----</span>+-------+--------------------------------+-----
 100 | alice | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>san francisco, <span class="nv">state</span><span class="o">=</span>ca<span class="o">}</span> |  25
 101 | bob   | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>seattle, <span class="nv">state</span><span class="o">=</span>wa<span class="o">}</span>       |  25
<span class="o">(</span>2 rows<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select </span>uid, user from recordservice.default.users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uid | user
<span class="nt">-----</span>+-------
 100 | alice
 101 | bob
<span class="o">(</span>2 rows<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select </span>uid, address from recordservice.default.users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> uid |            address
<span class="nt">-----</span>+--------------------------------
 100 | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>san francisco, <span class="nv">state</span><span class="o">=</span>ca<span class="o">}</span>
 101 | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>seattle, <span class="nv">state</span><span class="o">=</span>wa<span class="o">}</span>
<span class="o">(</span>2 rows<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select </span>uid, address.city from recordservice.default.users<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> uid |     city
<span class="nt">-----</span>+---------------
 100 | san francisco
 101 | seattle
<span class="o">(</span>2 rows<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select</span> <span class="k">*</span> from recordservice.default.users where uid <span class="o">=</span> 100<span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uid | user  |            address             | age
<span class="nt">-----</span>+-------+--------------------------------+-----
 100 | alice | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>san francisco, <span class="nv">state</span><span class="o">=</span>ca<span class="o">}</span> |  25
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select </span>address.city, count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from recordservice.default.users group by address.city
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     city      | _col1
<span class="nt">---------------</span>+-------
 san francisco |     1
 seattle       |     1
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>presto&gt; <span class="k">select</span> <span class="k">*</span> from recordservice.default.users where address.state <span class="o">=</span> <span class="s1">'wa'</span><span class="p">;</span>
</code></pre></div></div>
<p><em>Results</em></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> uid | user |         address          | age
<span class="nt">-----</span>+------+--------------------------+-----
 101 | bob  | <span class="o">{</span><span class="nv">city</span><span class="o">=</span>seattle, <span class="nv">state</span><span class="o">=</span>wa<span class="o">}</span> |  25
<span class="o">(</span>1 row<span class="o">)</span>
</code></pre></div></div>

<h2 id="array">Array</h2>

<p>The DDL for creating tables that include array types is standard HiveQL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">user_phone_numbers</span><span class="p">(</span>
   <span class="n">phone_numbers</span> <span class="n">struct</span><span class="o">&lt;</span>
    <span class="n">uid</span><span class="p">:</span> <span class="n">BIGINT</span><span class="p">,</span>
    <span class="n">numbers</span><span class="p">:</span> <span class="n">ARRAY</span><span class="o">&lt;</span><span class="n">STRING</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">user</span><span class="p">:</span> <span class="n">STRING</span>
  <span class="o">&gt;</span>
<span class="p">)</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">AVRO</span>
<span class="k">LOCATION</span> <span class="s1">'s3://okera/rs-complex-users/'</span>
</code></pre></div></div>

<p>The table description should appear as follows:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">describe</span> <span class="n">user_phone_numbers</span><span class="p">;</span>
<span class="n">uid</span>	<span class="n">bigint</span>
<span class="n">numbers</span> <span class="n">array</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span>
<span class="k">user</span> <span class="n">string</span>
</code></pre></div></div>

<h3 id="scanning-with-the-rest-api">Scanning with the REST API</h3>

<p>The REST API returns arrays as a JSON ordered list. A curl on the endpoint for the <code class="highlighter-rouge">user_phone_numbers</code> table would return:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> curl REST_SERVER:PORT/api/scan/user_phone_numbers?records<span class="o">=</span>1
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"phone_numbers"</span>: <span class="o">{</span>
            <span class="s2">"uid"</span>: 123,
            <span class="s2">"numbers"</span>: <span class="o">[</span>
                <span class="s2">"111-222-3333"</span>,
                <span class="s2">"444-555-6666"</span>
            <span class="o">]</span>,
            <span class="s2">"user"</span>: <span class="s2">"john"</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></div></div>

<h3 id="scanning-with-the-sparksql">Scanning with the SparkSQL</h3>

<p>ODAS support for array types aligns with Spark’s array type. To create an ephemeral view:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="n">s</span><span class="s">"""
    |CREATE TEMPORARY VIEW user_phone_numbers
    |USING com.cerebro.recordservice.spark.DefaultSource
    |OPTIONS (RecordServiceTable 'rs_complex.user_phone_numbers')
"""</span><span class="o">.</span><span class="n">stripMargin</span><span class="o">)</span>
</code></pre></div></div>

<p>A <code class="highlighter-rouge">SELECT</code> on all fields, including the array type, will return:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"SELECT * FROM user_phone_numbers"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>       <span class="n">phone_numbers</span><span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|[</span><span class="err">123</span>,<span class="kt">WrappedArray...|</span>
<span class="kt">|</span><span class="o">[</span><span class="err">234</span>,<span class="kt">WrappedArray...|</span>
<span class="kt">|</span><span class="o">[</span><span class="err">345</span>,<span class="kt">WrappedArray...|</span>
<span class="kt">+--------------------+</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"select phone_numbers.numbers from user_phone_numbers"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>             <span class="n">numbers</span><span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|[</span><span class="err">111</span><span class="kt">-</span><span class="err">222</span><span class="kt">-</span><span class="err">3333</span>, <span class="err">44</span><span class="kt">...|</span>
<span class="kt">|</span><span class="o">[</span><span class="err">222</span><span class="kt">-</span><span class="err">333</span><span class="kt">-</span><span class="err">4444</span>, <span class="err">55</span><span class="kt">...|</span>
<span class="kt">|</span>      <span class="o">[</span><span class="err">111</span><span class="kt">-</span><span class="err">222</span><span class="kt">-</span><span class="err">5555</span><span class="o">]</span><span class="kt">|</span>
<span class="kt">+--------------------+</span>
</code></pre></div></div>

<h3 id="scanning-table-data-with-apache-hive">Scanning table data with Apache Hive</h3>

<p>Support for array types also aligns with Hive’s array type.</p>

<p>A <code class="highlighter-rouge">SELECT</code>`on all fields including an array type and one on the array type alone are shown below:</p>

<pre><code class="language-hive">hive&gt; SELECT * FROM user_phone_numbers
{"uid":123,"numbers":["111-222-3333","444-555-6666"],"user":"john"}
{"uid":234,"numbers":["222-333-4444","555-666-7777"],"user":"jim"}
{"uid":345,"numbers":["111-222-5555"],"user":"jack"}
</code></pre>

<pre><code class="language-hive">hive&gt; select phone_numbers.numbers from user_phone_numbers
["111-222-3333","444-555-6666"]
["222-333-4444","555-666-7777"]
["111-222-5555"]
</code></pre>

<h3 id="scanning-table-data-with-presto-1">Scanning table data with Presto</h3>

<p>Support for array types also aligns with Presto’s array type.</p>

<p>A <code class="highlighter-rouge">SELECT</code> on all the fields including an array type and the array type by itself are shown below:</p>

<pre><code class="language-presto">presto&gt; select * from recordservice.rs_complex.user_phone_numbers;
                       phone_numbers
------------------------------------------------------------
 {uid=123, numbers=[111-222-3333, 444-555-6666], user=john}
 {uid=234, numbers=[222-333-4444, 555-666-7777], user=jim}
 {uid=345, numbers=[111-222-5555], user=jack}
</code></pre>

<pre><code class="language-presto">presto&gt; select phone_numbers.numbers from recordservice.rs_complex.user_phone_numbers;
           numbers
------------------------------
 [111-222-3333, 444-555-6666]
 [222-333-4444, 555-666-7777]
 [111-222-5555]
</code></pre>

<p>The returned records would be consistent and similar to results from other file formats.</p>

<h2 id="map">Map</h2>

<h3 id="scope-of-support">Scope of support</h3>

<p>Maps are supported for map&lt;string, primitiveType&gt; implementations. Mapping to a complex type (e.g., map&lt;string, complexType&gt; is not yet supported.</p>

<h3 id="using-map-types">Using Map types</h3>

<p>The DDL for creating tables with a map type corresponds to standard HiveQL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">user_phone_numbers_map</span><span class="p">(</span>
   <span class="n">uid</span> <span class="n">BIGINT</span><span class="p">,</span>
   <span class="n">username</span> <span class="n">STRING</span><span class="p">,</span>
   <span class="n">contact_numbers</span> <span class="k">MAP</span><span class="o">&lt;</span><span class="n">STRING</span><span class="p">,</span> <span class="n">STRING</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">AVRO</span>
<span class="k">LOCATION</span> <span class="s1">'s3://okera/rs-complex-map-userphones'</span>
</code></pre></div></div>

<p>A description of this table should return:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">describe</span> <span class="n">user_phone_numbers_map</span><span class="p">;</span>
<span class="n">uid</span>	<span class="n">bigint</span>
<span class="n">username</span> <span class="n">string</span>
<span class="n">contact_numbers</span> <span class="k">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="n">string</span><span class="o">&gt;</span>
</code></pre></div></div>

<h3 id="scanning-with-the-rest-api-1">Scanning with the REST API</h3>

<p>The REST API returns Map types as a JSON object in the form of name-value pairs. A curl on the endpoint for the <code class="highlighter-rouge">user_phone_numbers_map</code> table should return:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> curl REST_SERVER:PORT/api/scan/user_phone_numbers_map?records<span class="o">=</span>1&amp;format<span class="o">=</span>1
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"uid"</span>: 1,
        <span class="s2">"username"</span>: <span class="s2">"Alex"</span>,
        <span class="s2">"contact_numbers"</span>: <span class="o">{</span>
            <span class="s2">"work"</span>: <span class="s2">"444-555-6666"</span>,
            <span class="s2">"home"</span>: <span class="s2">"111-222-3333"</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></div></div>

<h3 id="scanning-table-data-via-sparksql">Scanning table data via SparkSQL</h3>

<p>ODAS support for map types aligns with Spark’s map type. A select on all fields including a map type returns:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">"select * from rs_complex.user_phone_numbers_map"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
<span class="o">+---+--------+--------------------+</span>
<span class="o">|</span><span class="n">uid</span><span class="o">|</span><span class="n">username</span><span class="o">|</span>     <span class="n">contact_numbers</span><span class="o">|</span>
<span class="o">+---+--------+--------------------+</span>
<span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>    <span class="nc">Alex</span><span class="o">|[</span><span class="kt">work</span> <span class="kt">-&gt;</span> <span class="err">444</span><span class="kt">-</span><span class="err">555</span><span class="kt">-...|</span>
<span class="kt">|</span>  <span class="err">2</span><span class="kt">|</span> <span class="kt">Melinda|</span><span class="o">[</span><span class="kt">work</span> <span class="kt">-&gt;</span> <span class="err">444</span><span class="kt">-</span><span class="err">555</span><span class="kt">-...|</span>
<span class="kt">+---+--------+--------------------+</span>
</code></pre></div></div>

<h3 id="scanning-table-data-with-apache-hive-1">Scanning table data with Apache Hive</h3>

<p>Support for map types also aligns with Hive’s map type. A <code class="highlighter-rouge">SELECT</code> on all fields including a map type will return:</p>

<pre><code class="language-hive">hive&gt; SELECT * FROM rs_complex.user_phone_numbers_map;
OK
1	Alex	{"work":"444-555-6666","home":"111-222-3333"}
2	Melinda	{"work":"444-555-8888","home":"111-222-7777"}
</code></pre>

<h2 id="limited-support-for-unions-in-avro">Limited support for unions in Avro</h2>

<p>The Avro specification uses unions only to incorporate the NULL type into all other types, thus making all Avro types nullable.
All types in ODAS are also nullable. In this context, the specific case for Avro unions is supported. Any other use case, such as accepting a union between a string and int type, is not supported.</p>

<h2 id="support-for-the-enum-type-in-avro">Support for the enum type in Avro</h2>

<p>The Avro specification defines enums as a complex type; ODAS does not. A table or view in ODAS cannot define a column with the <code class="highlighter-rouge">ENUM</code> type).</p>

<p>The ODAS engine will, however, convert any Avro field of enum type to a string if the corresponding table column is declared as <code class="highlighter-rouge">STRING</code>. This behavior matches what Hive does under the same conditions.</p>


    <div class="tags">
        
    </div>




</div>



<footer>
  <div class="row">
    <div class="col-lg-12 footer">
      <div class="footer-meta">
        &copy;2019 Okera, Inc. All rights reserved.  Site last generated: Apr 11, 2019
      </div>
    </div>
  </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
